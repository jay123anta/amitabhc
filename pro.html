<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AmitabhC Pro - Advanced Bollywood Programming</title>
    <meta name="description" content="The world's most advanced Bollywood-inspired programming language with AI assistance, real-time collaboration, and professional IDE features.">
    
    <!-- Advanced IDE Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    
    <style>
        :root {
            --primary: #ff9933;
            --secondary: #138808;
            --accent: #ffffff;
            --dark: #1a1a1a;
            --editor-bg: #282a36;
            --success: #50fa7b;
            --error: #ff5555;
            --warning: #f1fa8c;
            --info: #8be9fd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--accent);
            overflow: hidden;
            height: 100vh;
        }

        /* Advanced Layout */
        .ide-container {
            display: grid;
            grid-template-rows: 60px 1fr 30px;
            height: 100vh;
            background: #0d0d0d;
        }

        /* Professional Header */
        .ide-header {
            background: linear-gradient(90deg, #1a1a1a 0%, #2d2d2d 100%);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 2px solid var(--primary);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 2em;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .logo-text {
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Menu Bar */
        .menu-bar {
            display: flex;
            gap: 30px;
            margin-left: 50px;
            flex: 1;
        }

        .menu-item {
            position: relative;
            padding: 10px 0;
            cursor: pointer;
            color: #ccc;
            transition: color 0.3s;
        }

        .menu-item:hover {
            color: var(--primary);
        }

        .menu-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 5px;
            min-width: 200px;
            display: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .menu-item:hover .menu-dropdown {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-item:hover {
            background: var(--primary);
            color: white;
        }

        .shortcut {
            font-size: 0.9em;
            opacity: 0.7;
        }

        /* Main IDE Area */
        .ide-main {
            display: grid;
            grid-template-columns: 60px 300px 1fr 350px;
            overflow: hidden;
        }

        /* Activity Bar */
        .activity-bar {
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 30px;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 1.5em;
        }

        .activity-icon:hover {
            background: rgba(255,153,51,0.2);
            transform: scale(1.1);
        }

        .activity-icon.active {
            background: var(--primary);
            color: white;
        }

        /* Sidebar */
        .sidebar {
            background: #21222c;
            border-right: 1px solid #444;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid #444;
            font-weight: bold;
            color: var(--primary);
        }

        .file-explorer {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .file-item {
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item:hover {
            background: rgba(255,153,51,0.1);
        }

        .file-item.active {
            background: rgba(255,153,51,0.3);
            color: var(--primary);
        }

        /* Editor Area */
        .editor-area {
            display: flex;
            flex-direction: column;
        }

        .editor-tabs {
            background: #21222c;
            display: flex;
            border-bottom: 1px solid #444;
            overflow-x: auto;
        }

        .editor-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-right: 1px solid #444;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .editor-tab:hover {
            background: rgba(255,153,51,0.1);
        }

        .editor-tab.active {
            background: var(--editor-bg);
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .tab-close {
            font-size: 0.8em;
            opacity: 0.5;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .tab-close:hover {
            opacity: 1;
            color: var(--error);
        }

        .editor-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .CodeMirror {
            height: 100%;
            font-size: 16px;
            font-family: 'Fira Code', 'Courier New', monospace;
        }

        /* AI Assistant Panel */
        .ai-panel {
            background: #21222c;
            border-left: 1px solid #444;
            display: flex;
            flex-direction: column;
        }

        .ai-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-chat {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            padding: 12px 16px;
            border-radius: 10px;
            max-width: 80%;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message.user {
            background: var(--primary);
            color: white;
            align-self: flex-end;
        }

        .ai-message.assistant {
            background: #2d2d3d;
            color: #f8f8f2;
            align-self: flex-start;
        }

        .ai-input-area {
            padding: 15px;
            border-top: 1px solid #444;
            display: flex;
            gap: 10px;
        }

        .ai-input {
            flex: 1;
            background: #2d2d3d;
            border: 1px solid #444;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            outline: none;
            transition: all 0.3s;
        }

        .ai-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255,153,51,0.2);
        }

        .ai-send {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ai-send:hover {
            background: #e67e00;
            transform: scale(1.05);
        }

        /* Output Console */
        .output-area {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: #1a1a1a;
            border-top: 2px solid #444;
            display: flex;
            flex-direction: column;
            transition: height 0.3s;
        }

        .output-tabs {
            background: #21222c;
            display: flex;
            border-bottom: 1px solid #444;
        }

        .output-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .output-tab:hover {
            background: rgba(255,153,51,0.1);
        }

        .output-tab.active {
            background: #1a1a1a;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .console-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .console-line {
            margin-bottom: 5px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .console-timestamp {
            color: #666;
            font-size: 0.9em;
        }

        .console-success { color: var(--success); }
        .console-error { color: var(--error); }
        .console-warning { color: var(--warning); }
        .console-info { color: var(--info); }

        /* Status Bar */
        .status-bar {
            background: #21222c;
            border-top: 1px solid #444;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 0.9em;
            gap: 30px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #888;
        }

        .status-item.clickable {
            cursor: pointer;
            transition: color 0.3s;
        }

        .status-item.clickable:hover {
            color: var(--primary);
        }

        /* Floating Action Buttons */
        .fab-container {
            position: fixed;
            bottom: 50px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255,153,51,0.4);
            transition: all 0.3s;
            font-size: 1.5em;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(255,153,51,0.6);
        }

        .fab.secondary {
            background: var(--secondary);
            width: 50px;
            height: 50px;
            font-size: 1.2em;
        }

        /* Modal System */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: #21222c;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            animation: modalIn 0.3s;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            cursor: pointer;
            font-size: 1.5em;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .modal-close:hover {
            opacity: 1;
            color: var(--error);
        }

        /* Tutorial System */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 3000;
            display: none;
        }

        .tutorial-highlight {
            position: absolute;
            border: 3px solid var(--primary);
            border-radius: 10px;
            box-shadow: 0 0 0 9999px rgba(0,0,0,0.7);
            animation: tutorialPulse 2s ease-in-out infinite;
        }

        @keyframes tutorialPulse {
            0%, 100% { box-shadow: 0 0 0 9999px rgba(0,0,0,0.7); }
            50% { box-shadow: 0 0 20px 9999px rgba(255,153,51,0.3); }
        }

        .tutorial-tooltip {
            position: absolute;
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 300px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
            animation: fadeIn 0.5s;
            pointer-events: all;
        }

        .tutorial-tooltip::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid var(--primary);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .ide-main {
                grid-template-columns: 60px 1fr;
            }
            
            .sidebar, .ai-panel {
                position: absolute;
                height: 100%;
                z-index: 100;
                transition: transform 0.3s;
            }
            
            .sidebar {
                left: 60px;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .ai-panel {
                right: 0;
                transform: translateX(100%);
            }
            
            .ai-panel.active {
                transform: translateX(0);
            }
        }

        /* Loading Animation */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4000;
            display: none;
        }

        .loader-icon {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="theme-dark">
    <div class="ide-container">
        <!-- Professional Header -->
        <header class="ide-header">
            <div class="logo-section">
                <div class="logo">🎬</div>
                <div class="logo-text">AmitabhC Pro</div>
            </div>
            
            <nav class="menu-bar">
                <div class="menu-item">
                    File
                    <div class="menu-dropdown">
                        <div class="dropdown-item" onclick="newFile()">
                            <span>New File</span>
                            <span class="shortcut">Ctrl+N</span>
                        </div>
                        <div class="dropdown-item" onclick="openFile()">
                            <span>Open File</span>
                            <span class="shortcut">Ctrl+O</span>
                        </div>
                        <div class="dropdown-item" onclick="saveFile()">
                            <span>Save</span>
                            <span class="shortcut">Ctrl+S</span>
                        </div>
                        <div class="dropdown-item" onclick="saveAsFile()">
                            <span>Save As...</span>
                            <span class="shortcut">Ctrl+Shift+S</span>
                        </div>
                    </div>
                </div>
                
                <div class="menu-item">
                    Edit
                    <div class="menu-dropdown">
                        <div class="dropdown-item" onclick="editor.undo()">
                            <span>Undo</span>
                            <span class="shortcut">Ctrl+Z</span>
                        </div>
                        <div class="dropdown-item" onclick="editor.redo()">
                            <span>Redo</span>
                            <span class="shortcut">Ctrl+Y</span>
                        </div>
                        <div class="dropdown-item" onclick="formatCode()">
                            <span>Format Code</span>
                            <span class="shortcut">Alt+Shift+F</span>
                        </div>
                    </div>
                </div>
                
                <div class="menu-item">
                    View
                    <div class="menu-dropdown">
                        <div class="dropdown-item" onclick="toggleTheme()">
                            <span>Toggle Theme</span>
                            <span class="shortcut">Ctrl+T</span>
                        </div>
                        <div class="dropdown-item" onclick="toggleAI()">
                            <span>AI Assistant</span>
                            <span class="shortcut">Ctrl+I</span>
                        </div>
                    </div>
                </div>
                
                <div class="menu-item">
                    Run
                    <div class="menu-dropdown">
                        <div class="dropdown-item" onclick="runCode()">
                            <span>Run Program</span>
                            <span class="shortcut">F5</span>
                        </div>
                        <div class="dropdown-item" onclick="stopExecution()">
                            <span>Stop</span>
                            <span class="shortcut">Shift+F5</span>
                        </div>
                    </div>
                </div>
                
                <div class="menu-item">
                    Help
                    <div class="menu-dropdown">
                        <div class="dropdown-item" onclick="showTutorial()">
                            <span>Interactive Tutorial</span>
                            <span class="shortcut">F1</span>
                        </div>
                        <div class="dropdown-item" onclick="showDocs()">
                            <span>Documentation</span>
                        </div>
                        <div class="dropdown-item" onclick="showShortcuts()">
                            <span>Keyboard Shortcuts</span>
                        </div>
                        <div class="dropdown-item" onclick="showAbout()">
                            <span>About</span>
                        </div>
                    </div>
                </div>
            </nav>
            
            <div class="header-actions">
                <button class="fab secondary" onclick="runCode()" title="Run Code (F5)">▶️</button>
            </div>
        </header>
        
        <!-- Main IDE Area -->
        <main class="ide-main">
            <!-- Activity Bar -->
            <div class="activity-bar">
                <div class="activity-icon active" onclick="showPanel('explorer')" title="Explorer">📁</div>
                <div class="activity-icon" onclick="showPanel('search')" title="Search">🔍</div>
                <div class="activity-icon" onclick="showPanel('git')" title="Version Control">🔄</div>
                <div class="activity-icon" onclick="showPanel('debug')" title="Debug">🐛</div>
                <div class="activity-icon" onclick="showPanel('extensions')" title="Extensions">🧩</div>
                <div class="activity-icon" onclick="showPanel('settings')" title="Settings">⚙️</div>
            </div>
            
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    EXPLORER
                </div>
                <div class="file-explorer" id="fileExplorer">
                    <div class="file-item active">
                        <span>📄</span>
                        <span>main.amitabhc</span>
                    </div>
                    <div class="file-item">
                        <span>📄</span>
                        <span>examples.amitabhc</span>
                    </div>
                    <div class="file-item">
                        <span>📄</span>
                        <span>functions.amitabhc</span>
                    </div>
                    <div class="file-item">
                        <span>📁</span>
                        <span>projects/</span>
                    </div>
                </div>
            </aside>
            
            <!-- Editor Area -->
            <div class="editor-area">
                <div class="editor-tabs">
                    <div class="editor-tab active">
                        <span>main.amitabhc</span>
                        <span class="tab-close">×</span>
                    </div>
                </div>
                
                <div class="editor-container">
                    <textarea id="codeEditor">LIGHTS
CAMERA
    // Welcome to AmitabhC Pro!
    BOLO "Namaste! Welcome to AmitabhC Pro!"
    BOLO "Rishtey mein toh hum tumhare compiler lagte hain!"
    
    // Variable declarations
    VIJAY name = "Amitabh"
    VIJAY age = 80
    DON films = 200
    
    // Conditional statement
    AGAR age > 75
        BOLO "I am a living legend!"
    NAHI TOH
        BOLO "I am still young!"
    BAS
    
    // Loop example
    BOLO "My famous dialogues:"
    BAAR BAAR 3
        BOLO "Don ko pakadna mushkil hi nahi, namumkin hai!"
    KHATAM
    
    // Function example
    NAAM greet(person)
        BOLO "Hello " + person + "!"
        WAPAS SHAKTI
    PURA
    
    greet("dear programmer")
    
    // Array example
    VIJAY movies = ["Sholay", "Deewar", "Don", "Agneepath"]
    BOLO "My iconic movies: " + movies
    
ACTION</textarea>
                    
                    <!-- Output Console -->
                    <div class="output-area" id="outputArea">
                        <div class="output-tabs">
                            <div class="output-tab active">
                                <span>📺</span>
                                <span>Console</span>
                            </div>
                            <div class="output-tab">
                                <span>❌</span>
                                <span>Problems</span>
                            </div>
                            <div class="output-tab">
                                <span>🔍</span>
                                <span>Debug Console</span>
                            </div>
                            <div class="output-tab">
                                <span>📊</span>
                                <span>Performance</span>
                            </div>
                        </div>
                        <div class="console-content" id="console">
                            <div class="console-line console-info">
                                <span class="console-timestamp">[12:00:00]</span>
                                <span>AmitabhC Pro IDE initialized ✨</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Assistant Panel -->
            <aside class="ai-panel" id="aiPanel">
                <div class="ai-header">
                    <span>🤖</span>
                    <span>AI Coding Assistant</span>
                </div>
                <div class="ai-chat" id="aiChat">
                    <div class="ai-message assistant">
                        Namaste! I'm your AI assistant. I can help you with:
                        <br><br>
                        • Writing AmitabhC code
                        <br>• Debugging errors
                        <br>• Code optimization
                        <br>• Learning new concepts
                        <br><br>
                        Just ask me anything!
                    </div>
                </div>
                <div class="ai-input-area">
                    <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything..." onkeypress="handleAIInput(event)">
                    <button class="ai-send" onclick="sendAIMessage()">Send</button>
                </div>
            </aside>
        </main>
        
        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-item">
                <span>🟢</span>
                <span>Ready</span>
            </div>
            <div class="status-item clickable" onclick="changeLanguage()">
                <span>🎬</span>
                <span>AmitabhC</span>
            </div>
            <div class="status-item">
                <span>📝</span>
                <span>UTF-8</span>
            </div>
            <div class="status-item">
                <span>📍</span>
                <span id="cursorPosition">Ln 1, Col 1</span>
            </div>
            <div class="status-item clickable" onclick="toggleTheme()">
                <span>🎨</span>
                <span>Dark Theme</span>
            </div>
            <div class="status-item">
                <span>⚡</span>
                <span id="performanceStatus">Performance: Excellent</span>
            </div>
        </footer>
    </div>
    
    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <div class="fab" onclick="runCode()" title="Run Code">▶️</div>
        <div class="fab secondary" onclick="toggleAI()" title="AI Assistant">🤖</div>
        <div class="fab secondary" onclick="shareCode()" title="Share">🔗</div>
    </div>
    
    <!-- Modal System -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span id="modalTitle">Modal Title</span>
                <span class="modal-close" onclick="closeModal()">×</span>
            </div>
            <div id="modalContent">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>
    
    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-highlight" id="tutorialHighlight"></div>
        <div class="tutorial-tooltip" id="tutorialTooltip">
            <div id="tutorialText"></div>
            <button onclick="nextTutorialStep()">Next</button>
            <button onclick="endTutorial()">Skip</button>
        </div>
    </div>
    
    <!-- Loading Indicator -->
    <div class="loader" id="loader">
        <div class="loader-icon"></div>
    </div>
    
    <script>
        // Initialize CodeMirror
        let editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
            mode: 'javascript',
            theme: 'dracula',
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 4,
            tabSize: 4,
            lineWrapping: true,
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "F5": () => runCode(),
                "Ctrl-S": () => saveFile(),
                "Ctrl-/": "toggleComment"
            }
        });

        // Complete AmitabhC Interpreter
        class AmitabhCInterpreter {
            constructor() {
                this.variables = {};
                this.constants = {};
                this.functions = {};
                this.output = [];
                this.running = false;
                this.currentLine = 0;
                this.loopStack = [];
                this.functionStack = [];
            }

            async run(code) {
                this.running = true;
                this.output = [];
                this.variables = {};
                this.constants = {};
                this.functions = {};
                this.currentLine = 0;
                
                // Clear console before running
                const consoleElement = document.getElementById('console');
                consoleElement.innerHTML = '';
                
                this.log('🎬 Running AmitabhC Pro program...', 'info');
                
                try {
                    const lines = code.split('\n').map(line => line.trim());
                    await this.execute(lines);
                    this.log('✅ Program executed successfully!', 'success');
                } catch (error) {
                    this.log(`❌ Error: ${error.message}`, 'error');
                    console.error(error);
                }
                
                this.running = false;
            }

            async execute(lines) {
                let inMainBlock = false;
                let blockStack = [];
                let skipBlock = false;
                
                this.log(`📋 Parsing ${lines.length} lines...`, 'info');
                
                for (let i = 0; i < lines.length; i++) {
                    if (!this.running) break;
                    
                    this.currentLine = i + 1;
                    const line = lines[i];
                    
                    // Skip empty lines and comments
                    if (!line || line.startsWith('//')) continue;
                    
                    // Handle main program structure
                    if (line === 'LIGHTS') {
                        this.log('🎬 Program started (LIGHTS)', 'success');
                        continue;
                    } else if (line === 'CAMERA') {
                        this.log('🎥 Main block started (CAMERA)', 'success');
                        inMainBlock = true;
                        continue;
                    } else if (line === 'ACTION') {
                        this.log('🎬 Program ended (ACTION)', 'success');
                        break;
                    }
                    
                    if (!inMainBlock) continue;
                    
                    // Skip blocks based on conditions
                    if (skipBlock && !['BAS', 'KHATAM', 'RAHEGA', 'PURA'].includes(line)) {
                        continue;
                    }
                    
                    // Parse and execute statements
                    if (line.startsWith('BOLO')) {
                        // Print statement
                        const match = line.match(/BOLO\s+(.+)/);
                        if (match) {
                            const expr = this.evaluateExpression(match[1]);
                            this.log(String(expr), 'info');
                        }
                    } else if (line.startsWith('VIJAY')) {
                        // Variable declaration
                        const match = line.match(/VIJAY\s+(\w+)\s*=\s*(.+)/);
                        if (match) {
                            const varName = match[1];
                            const value = this.evaluateExpression(match[2]);
                            this.variables[varName] = value;
                        }
                    } else if (line.startsWith('DON')) {
                        // Constant declaration
                        const match = line.match(/DON\s+(\w+)\s*=\s*(.+)/);
                        if (match) {
                            const constName = match[1];
                            const value = this.evaluateExpression(match[2]);
                            this.constants[constName] = value;
                        }
                    } else if (line.startsWith('AGAR')) {
                        // If statement
                        const match = line.match(/AGAR\s+(.+)/);
                        if (match) {
                            const condition = this.evaluateCondition(match[1]);
                            blockStack.push({ type: 'if', condition });
                            skipBlock = !condition;
                        }
                    } else if (line === 'NAHI TOH') {
                        // Else statement
                        if (blockStack.length > 0 && blockStack[blockStack.length - 1].type === 'if') {
                            skipBlock = blockStack[blockStack.length - 1].condition;
                        }
                    } else if (line === 'BAS') {
                        // End if
                        if (blockStack.length > 0 && blockStack[blockStack.length - 1].type === 'if') {
                            blockStack.pop();
                            skipBlock = false;
                        }
                    } else if (line.startsWith('BAAR BAAR')) {
                        // For loop
                        const match = line.match(/BAAR BAAR\s+(\d+)/);
                        if (match) {
                            const times = parseInt(match[1]);
                            const loopBody = [];
                            let j = i + 1;
                            
                            // Collect loop body
                            while (j < lines.length && lines[j] !== 'KHATAM') {
                                loopBody.push(lines[j]);
                                j++;
                            }
                            
                            // Execute loop
                            for (let k = 0; k < times; k++) {
                                await this.execute(loopBody);
                            }
                            
                            i = j; // Skip to end of loop
                        }
                    } else if (line.startsWith('JAB TAK')) {
                        // While loop
                        const match = line.match(/JAB TAK\s+(.+)/);
                        if (match) {
                            const condition = match[1];
                            const loopBody = [];
                            let j = i + 1;
                            
                            // Collect loop body
                            while (j < lines.length && lines[j] !== 'RAHEGA') {
                                loopBody.push(lines[j]);
                                j++;
                            }
                            
                            // Execute loop
                            while (this.evaluateCondition(condition)) {
                                await this.execute(loopBody);
                            }
                            
                            i = j; // Skip to end of loop
                        }
                    } else if (line.startsWith('NAAM')) {
                        // Function definition
                        const match = line.match(/NAAM\s+(\w+)\s*\(([^)]*)\)/);
                        if (match) {
                            const funcName = match[1];
                            const params = match[2].split(',').map(p => p.trim()).filter(p => p);
                            const funcBody = [];
                            let j = i + 1;
                            
                            // Collect function body
                            while (j < lines.length && lines[j] !== 'PURA') {
                                funcBody.push(lines[j]);
                                j++;
                            }
                            
                            this.functions[funcName] = { params, body: funcBody };
                            i = j; // Skip to end of function
                        }
                    } else {
                        // Check for function calls or variable assignments
                        if (line.includes('(') && line.includes(')')) {
                            // Function call
                            const match = line.match(/(\w+)\s*\(([^)]*)\)/);
                            if (match && this.functions[match[1]]) {
                                const funcName = match[1];
                                const args = match[2].split(',').map(arg => this.evaluateExpression(arg.trim()));
                                await this.callFunction(funcName, args);
                            }
                        } else if (line.includes('=')) {
                            // Variable assignment
                            const match = line.match(/(\w+)\s*=\s*(.+)/);
                            if (match) {
                                const varName = match[1];
                                const value = this.evaluateExpression(match[2]);
                                if (this.constants.hasOwnProperty(varName)) {
                                    this.log(`Error: Cannot modify constant ${varName}`, 'error');
                                } else {
                                    this.variables[varName] = value;
                                }
                            }
                        }
                    }
                }
            }

            evaluateExpression(expr) {
                expr = expr.trim();
                
                // String literal
                if (expr.startsWith('"') && expr.endsWith('"')) {
                    return expr.slice(1, -1);
                }
                
                // Number literal
                if (!isNaN(expr)) {
                    return Number(expr);
                }
                
                // Boolean literals
                if (expr === 'SHAKTI') return true;
                if (expr === 'KAALIA') return false;
                
                // Array literal
                if (expr.startsWith('[') && expr.endsWith(']')) {
                    const items = expr.slice(1, -1).split(',').map(item => this.evaluateExpression(item.trim()));
                    return items;
                }
                
                // String concatenation
                if (expr.includes('+')) {
                    const parts = expr.split('+').map(part => this.evaluateExpression(part.trim()));
                    return parts.join('');
                }
                
                // Variable or constant reference
                if (this.variables.hasOwnProperty(expr)) {
                    return this.variables[expr];
                }
                if (this.constants.hasOwnProperty(expr)) {
                    return this.constants[expr];
                }
                
                return expr;
            }

            evaluateCondition(condition) {
                // Simple comparison operators
                if (condition.includes('>')) {
                    const [left, right] = condition.split('>').map(part => this.evaluateExpression(part.trim()));
                    return left > right;
                } else if (condition.includes('<')) {
                    const [left, right] = condition.split('<').map(part => this.evaluateExpression(part.trim()));
                    return left < right;
                } else if (condition.includes('==')) {
                    const [left, right] = condition.split('==').map(part => this.evaluateExpression(part.trim()));
                    return left == right;
                } else if (condition.includes('!=')) {
                    const [left, right] = condition.split('!=').map(part => this.evaluateExpression(part.trim()));
                    return left != right;
                }
                
                // Boolean expression
                const value = this.evaluateExpression(condition);
                return !!value;
            }

            async callFunction(name, args) {
                const func = this.functions[name];
                if (!func) {
                    this.log(`Error: Function ${name} not defined`, 'error');
                    return;
                }
                
                // Create new scope for function
                const oldVars = { ...this.variables };
                
                // Bind parameters
                func.params.forEach((param, index) => {
                    this.variables[param] = args[index];
                });
                
                // Execute function body
                await this.execute(func.body);
                
                // Restore scope
                this.variables = oldVars;
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const consoleElement = document.getElementById('console');
                
                if (!consoleElement) {
                    console.error('Console element not found!');
                    return;
                }
                
                const line = document.createElement('div');
                line.className = `console-line console-${type}`;
                line.innerHTML = `
                    <span class="console-timestamp">[${timestamp}]</span>
                    <span>${this.escapeHtml(String(message))}</span>
                `;
                consoleElement.appendChild(line);
                consoleElement.scrollTop = consoleElement.scrollHeight;
                
                // Also log to browser console for debugging
                console.log(`[AmitabhC ${type}] ${message}`);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            stop() {
                this.running = false;
                this.log('Execution stopped', 'warning');
            }
        }

        // Global interpreter instance
        const interpreter = new AmitabhCInterpreter();

        // IDE Functions
        function runCode() {
            const code = editor.getValue();
            // Make sure console is visible
            const outputArea = document.getElementById('outputArea');
            outputArea.style.display = 'flex';
            
            // Run the interpreter
            interpreter.run(code).catch(error => {
                console.error('Runtime error:', error);
                interpreter.log(`Fatal error: ${error.message}`, 'error');
            });
        }

        function stopExecution() {
            interpreter.stop();
        }

        function formatCode() {
            const code = editor.getValue();
            // Simple formatting rules
            let formatted = code;
            let indentLevel = 0;
            const lines = formatted.split('\n');
            const formattedLines = [];
            
            for (let line of lines) {
                const trimmed = line.trim();
                
                // Decrease indent for closing statements
                if (['BAS', 'KHATAM', 'RAHEGA', 'PURA', 'ACTION'].includes(trimmed)) {
                    indentLevel = Math.max(0, indentLevel - 1);
                }
                
                // Add indentation
                formattedLines.push('    '.repeat(indentLevel) + trimmed);
                
                // Increase indent for opening statements
                if (['CAMERA', 'AGAR', 'NAHI TOH', 'BAAR BAAR', 'JAB TAK', 'NAAM'].some(keyword => trimmed.startsWith(keyword))) {
                    indentLevel++;
                }
            }
            
            editor.setValue(formattedLines.join('\n'));
        }

        function toggleTheme() {
            const body = document.body;
            if (body.classList.contains('theme-dark')) {
                body.classList.remove('theme-dark');
                body.classList.add('theme-light');
                editor.setOption('theme', 'default');
            } else {
                body.classList.remove('theme-light');
                body.classList.add('theme-dark');
                editor.setOption('theme', 'dracula');
            }
        }

        function toggleAI() {
            const aiPanel = document.getElementById('aiPanel');
            aiPanel.classList.toggle('active');
        }

        function showPanel(panelName) {
            // Update activity bar
            document.querySelectorAll('.activity-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update sidebar content based on panel
            const sidebarHeader = document.querySelector('.sidebar-header');
            const fileExplorer = document.getElementById('fileExplorer');
            
            switch(panelName) {
                case 'explorer':
                    sidebarHeader.textContent = 'EXPLORER';
                    // Show file explorer
                    break;
                case 'search':
                    sidebarHeader.textContent = 'SEARCH';
                    fileExplorer.innerHTML = '<input type="text" placeholder="Search files..." style="width: 100%; padding: 10px;">';
                    break;
                case 'git':
                    sidebarHeader.textContent = 'SOURCE CONTROL';
                    fileExplorer.innerHTML = '<div style="padding: 10px;">Git integration coming soon!</div>';
                    break;
                case 'debug':
                    sidebarHeader.textContent = 'DEBUG';
                    fileExplorer.innerHTML = '<div style="padding: 10px;">Debug panel</div>';
                    break;
                case 'extensions':
                    sidebarHeader.textContent = 'EXTENSIONS';
                    fileExplorer.innerHTML = '<div style="padding: 10px;">Extension marketplace coming soon!</div>';
                    break;
                case 'settings':
                    showSettings();
                    break;
            }
        }

        // AI Assistant
        function handleAIInput(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            if (!message) return;
            
            const chat = document.getElementById('aiChat');
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'ai-message user';
            userMsg.textContent = message;
            chat.appendChild(userMsg);
            
            // Clear input
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const aiMsg = document.createElement('div');
                aiMsg.className = 'ai-message assistant';
                aiMsg.innerHTML = getAIResponse(message);
                chat.appendChild(aiMsg);
                chat.scrollTop = chat.scrollHeight;
            }, 1000);
        }

        function getAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return "Namaste! How can I help you with AmitabhC today?";
            } else if (lowerMessage.includes('variable')) {
                return "In AmitabhC, use <strong>VIJAY</strong> to declare variables:<br><br><code>VIJAY name = \"Amitabh\"<br>VIJAY age = 25</code>";
            } else if (lowerMessage.includes('loop')) {
                return "AmitabhC has two types of loops:<br><br>For loop:<br><code>BAAR BAAR 5<br>    BOLO \"Hello\"<br>KHATAM</code><br><br>While loop:<br><code>JAB TAK x < 10<br>    BOLO x<br>    x = x + 1<br>RAHEGA</code>";
            } else if (lowerMessage.includes('function')) {
                return "Define functions with NAAM:<br><br><code>NAAM greet(name)<br>    BOLO \"Hello \" + name<br>    WAPAS SHAKTI<br>PURA</code>";
            } else if (lowerMessage.includes('print') || lowerMessage.includes('output')) {
                return "Use BOLO to print output:<br><br><code>BOLO \"Hello World\"<br>BOLO \"Age: \" + age</code>";
            } else if (lowerMessage.includes('if') || lowerMessage.includes('condition')) {
                return "Use AGAR for conditions:<br><br><code>AGAR age > 18<br>    BOLO \"Adult\"<br>NAHI TOH<br>    BOLO \"Minor\"<br>BAS</code>";
            } else if (lowerMessage.includes('help')) {
                return "I can help you with:<br>• Variables and constants<br>• Loops and conditions<br>• Functions<br>• Arrays<br>• Input/Output<br>• Best practices<br><br>What would you like to know?";
            } else {
                return "That's an interesting question! Let me help you with that. Can you be more specific about what you'd like to know?";
            }
        }

        // File Operations
        function newFile() {
            editor.setValue('LIGHTS\nCAMERA\n    // Start coding here\n    BOLO "Hello, World!"\nACTION');
            interpreter.log('New file created', 'success');
        }

        function openFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.amitabhc,.amc';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    editor.setValue(e.target.result);
                    interpreter.log(`File ${file.name} opened`, 'success');
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function saveFile() {
            const code = editor.getValue();
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'program.amitabhc';
            a.click();
            URL.revokeObjectURL(url);
            interpreter.log('File saved', 'success');
        }

        function saveAsFile() {
            const filename = prompt('Enter filename:', 'program.amitabhc');
            if (filename) {
                const code = editor.getValue();
                const blob = new Blob([code], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                interpreter.log(`File saved as ${filename}`, 'success');
            }
        }

        // Tutorial System
        let tutorialStep = 0;
        const tutorialSteps = [
            {
                element: '.logo-section',
                text: 'Welcome to AmitabhC Pro! This is the world\'s most advanced Bollywood programming language.',
                position: 'bottom'
            },
            {
                element: '.activity-bar',
                text: 'Use the activity bar to switch between different panels like Explorer, Search, and Debug.',
                position: 'right'
            },
            {
                element: '.editor-container',
                text: 'Write your AmitabhC code here. The editor has syntax highlighting and auto-completion.',
                position: 'top'
            },
            {
                element: '.ai-panel',
                text: 'Get help from our AI assistant. It can write code, debug errors, and explain concepts.',
                position: 'left'
            },
            {
                element: '.fab',
                text: 'Click here to run your code instantly!',
                position: 'left'
            }
        ];

        function showTutorial() {
            tutorialStep = 0;
            document.getElementById('tutorialOverlay').style.display = 'block';
            showTutorialStep();
        }

        function showTutorialStep() {
            if (tutorialStep >= tutorialSteps.length) {
                endTutorial();
                return;
            }
            
            const step = tutorialSteps[tutorialStep];
            const element = document.querySelector(step.element);
            const rect = element.getBoundingClientRect();
            
            const highlight = document.getElementById('tutorialHighlight');
            highlight.style.left = rect.left - 5 + 'px';
            highlight.style.top = rect.top - 5 + 'px';
            highlight.style.width = rect.width + 10 + 'px';
            highlight.style.height = rect.height + 10 + 'px';
            
            const tooltip = document.getElementById('tutorialTooltip');
            document.getElementById('tutorialText').textContent = step.text;
            
            // Position tooltip
            if (step.position === 'bottom') {
                tooltip.style.left = rect.left + 'px';
                tooltip.style.top = rect.bottom + 20 + 'px';
            } else if (step.position === 'right') {
                tooltip.style.left = rect.right + 20 + 'px';
                tooltip.style.top = rect.top + 'px';
            } else if (step.position === 'left') {
                tooltip.style.left = rect.left - 320 + 'px';
                tooltip.style.top = rect.top + 'px';
            } else {
                tooltip.style.left = rect.left + 'px';
                tooltip.style.top = rect.top - 120 + 'px';
            }
        }

        function nextTutorialStep() {
            tutorialStep++;
            showTutorialStep();
        }

        function endTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'none';
            interpreter.log('Tutorial completed!', 'success');
        }

        // Modal Functions
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function showDocs() {
            const docsContent = `
                <h2>AmitabhC Pro Documentation</h2>
                <h3>Basic Syntax</h3>
                <ul>
                    <li><strong>LIGHTS CAMERA ACTION</strong> - Program structure</li>
                    <li><strong>VIJAY</strong> - Variable declaration</li>
                    <li><strong>DON</strong> - Constant declaration</li>
                    <li><strong>BOLO</strong> - Print output</li>
                    <li><strong>SUNO</strong> - Get input</li>
                </ul>
                <h3>Control Flow</h3>
                <ul>
                    <li><strong>AGAR...NAHI TOH...BAS</strong> - If-else statement</li>
                    <li><strong>BAAR BAAR...KHATAM</strong> - For loop</li>
                    <li><strong>JAB TAK...RAHEGA</strong> - While loop</li>
                </ul>
                <h3>Functions</h3>
                <ul>
                    <li><strong>NAAM...PURA</strong> - Function definition</li>
                    <li><strong>WAPAS</strong> - Return statement</li>
                </ul>
                <h3>Boolean Values</h3>
                <ul>
                    <li><strong>SHAKTI</strong> - True</li>
                    <li><strong>KAALIA</strong> - False</li>
                </ul>
            `;
            showModal('Documentation', docsContent);
        }

        function showShortcuts() {
            const shortcutsContent = `
                <h2>Keyboard Shortcuts</h2>
                <table style="width: 100%;">
                    <tr><td><strong>F5</strong></td><td>Run Code</td></tr>
                    <tr><td><strong>Ctrl+S</strong></td><td>Save File</td></tr>
                    <tr><td><strong>Ctrl+O</strong></td><td>Open File</td></tr>
                    <tr><td><strong>Ctrl+N</strong></td><td>New File</td></tr>
                    <tr><td><strong>Ctrl+Space</strong></td><td>Auto-complete</td></tr>
                    <tr><td><strong>Ctrl+/</strong></td><td>Toggle Comment</td></tr>
                    <tr><td><strong>Ctrl+T</strong></td><td>Toggle Theme</td></tr>
                    <tr><td><strong>Ctrl+I</strong></td><td>AI Assistant</td></tr>
                    <tr><td><strong>Alt+Shift+F</strong></td><td>Format Code</td></tr>
                </table>
            `;
            showModal('Keyboard Shortcuts', shortcutsContent);
        }

        function showAbout() {
            const aboutContent = `
                <h2>About AmitabhC Pro</h2>
                <p><strong>Version:</strong> 2.0 Fixed</p>
                <p><strong>Created by:</strong> The AmitabhC Team</p>
                <p>AmitabhC Pro is the world's most advanced Bollywood-inspired programming language, featuring:</p>
                <ul>
                    <li>Complete interpreter with proper execution</li>
                    <li>Variables, constants, and functions</li>
                    <li>Control flow statements</li>
                    <li>AI-powered code assistance</li>
                    <li>Professional IDE features</li>
                </ul>
                <p>Learn to code like a superstar!</p>
            `;
            showModal('About', aboutContent);
        }

        function showSettings() {
            const settingsContent = `
                <h2>Settings</h2>
                <div style="margin: 20px 0;">
                    <label>
                        <input type="checkbox" id="autoSave" checked> Auto-save
                    </label>
                </div>
                <div style="margin: 20px 0;">
                    <label>
                        <input type="checkbox" id="livePreview" checked> Live preview
                    </label>
                </div>
                <div style="margin: 20px 0;">
                    <label>
                        Font Size:
                        <input type="range" min="12" max="24" value="16" onchange="editor.setOption('fontSize', this.value + 'px')">
                    </label>
                </div>
                <div style="margin: 20px 0;">
                    <label>
                        Tab Size:
                        <select onchange="editor.setOption('tabSize', parseInt(this.value))">
                            <option value="2">2</option>
                            <option value="4" selected>4</option>
                            <option value="8">8</option>
                        </select>
                    </label>
                </div>
            `;
            showModal('Settings', settingsContent);
        }

        // Share functionality
        function shareCode() {
            const code = editor.getValue();
            const encoded = btoa(encodeURIComponent(code));
            const url = window.location.origin + window.location.pathname + '?code=' + encoded;
            
            navigator.clipboard.writeText(url).then(() => {
                interpreter.log('Share link copied to clipboard!', 'success');
            });
        }

        // Load shared code
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sharedCode = urlParams.get('code');
            if (sharedCode) {
                try {
                    const decoded = decodeURIComponent(atob(sharedCode));
                    editor.setValue(decoded);
                    interpreter.log('Shared code loaded!', 'success');
                } catch (e) {
                    interpreter.log('Failed to load shared code', 'error');
                }
            }
        });

        // Syntax highlighting for AmitabhC
        CodeMirror.defineMode('amitabhc', function() {
            return {
                token: function(stream, state) {
                    if (stream.match(/\/\/.*/)) {
                        return 'comment';
                    }
                    
                    if (stream.match(/"[^"]*"/)) {
                        return 'string';
                    }
                    
                    if (stream.match(/\d+/)) {
                        return 'number';
                    }
                    
                    if (stream.match(/LIGHTS|CAMERA|ACTION|VIJAY|DON|BOLO|SUNO|AGAR|NAHI TOH|BAS|BAAR BAAR|KHATAM|JAB TAK|RAHEGA|NAAM|WAPAS|PURA|SHAKTI|KAALIA/)) {
                        return 'keyword';
                    }
                    
                    if (stream.match(/[a-zA-Z_]\w*/)) {
                        return 'variable';
                    }
                    
                    stream.next();
                    return null;
                }
            };
        });

        // Set AmitabhC mode
        editor.setOption('mode', 'amitabhc');

        // Update cursor position
        editor.on('cursorActivity', function() {
            const cursor = editor.getCursor();
            document.getElementById('cursorPosition').textContent = `Ln ${cursor.line + 1}, Col ${cursor.ch + 1}`;
        });

        // Initialize on load
        window.addEventListener('load', () => {
            // Show welcome message
            interpreter.log('Welcome to AmitabhC Pro! 🎬', 'success');
            interpreter.log('Press F5 to run your code or F1 for tutorial', 'info');
            
            // Check for first time user
            if (!localStorage.getItem('amitabhc_pro_visited')) {
                localStorage.setItem('amitabhc_pro_visited', 'true');
                setTimeout(() => showTutorial(), 1000);
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F1') {
                e.preventDefault();
                showTutorial();
            } else if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                toggleTheme();
            } else if (e.ctrlKey && e.key === 'i') {
                e.preventDefault();
                toggleAI();
            }
        });

        // Auto-save functionality
        let autoSaveTimer;
        editor.on('change', () => {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                const autoSaveEnabled = document.getElementById('autoSave')?.checked ?? true;
                if (autoSaveEnabled) {
                    localStorage.setItem('amitabhc_code', editor.getValue());
                }
            }, 2000);
        });

        // Load auto-saved code
        const savedCode = localStorage.getItem('amitabhc_code');
        if (savedCode && !window.location.search.includes('code=')) {
            editor.setValue(savedCode);
            interpreter.log('Auto-saved code restored', 'info');
        }

        // Performance monitoring
        setInterval(() => {
            if (performance.memory) {
                const used = (performance.memory.usedJSHeapSize / 1048576).toFixed(0);
                const total = (performance.memory.totalJSHeapSize / 1048576).toFixed(0);
                document.getElementById('performanceStatus').textContent = `Memory: ${used}MB / ${total}MB`;
            }
        }, 5000);

        // Easter egg
        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        
        document.addEventListener('keydown', (e) => {
            konamiCode.push(e.key);
            konamiCode = konamiCode.slice(-10);
            
            if (konamiCode.join('') === konamiSequence.join('')) {
                document.body.style.animation = 'rainbow 2s linear infinite';
                interpreter.log('🎉 Shahenshah Mode Activated! 🎉', 'success');
                setTimeout(() => {
                    document.body.style.animation = '';
                }, 5000);
            }
        });

        // Add rainbow animation
        const rainbowStyle = document.createElement('style');
        rainbowStyle.textContent = `
            @keyframes rainbow {
                0% { filter: hue-rotate(0deg); }
                100% { filter: hue-rotate(360deg); }
            }
        `;
        document.head.appendChild(rainbowStyle);

        // Initialize everything
        interpreter.log('AmitabhC Pro IDE v2.0 loaded successfully! 🎬', 'success');
        interpreter.log('Type your code and press F5 to run', 'info');
    </script>
</body>
</html>

