<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AmitabhC Pro - Professional Bollywood IDE</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' cdnjs.cloudflare.com; 
                   style-src 'self' 'unsafe-inline' cdnjs.cloudflare.com; 
                   img-src 'self' data:;
                   connect-src 'self';
                   frame-ancestors 'none';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- SEO and PWA Meta -->
    <meta name="description" content="AmitabhC Pro IDE - Professional Bollywood programming environment with AI assistant, advanced debugging, and enterprise features.">
    <meta name="keywords" content="AmitabhC Pro, IDE, Bollywood programming, AI assistant, professional development">
    <meta name="author" content="AmitabhC Team">
    <meta name="theme-color" content="#ff9933">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé¨</text></svg>">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- CodeMirror CDN with fallback -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" 
          onerror="this.onerror=null; this.href='css/vendor/codemirror.css';">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css"
          onerror="this.onerror=null; this.href='css/vendor/dracula.css';">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css"
          onerror="this.onerror=null; this.href='css/vendor/show-hint.css';">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Critical CSS for Pro IDE -->
    <style>
        /* Critical Pro IDE styles */
        .app {
            display: grid;
            grid-template-rows: 64px 1fr 32px;
            height: 100vh;
            background: #0d1117;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            padding: 0 24px;
            display: flex;
            align-items: center;
            gap: 24px;
            border-bottom: 3px solid #ff9933;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 100;
        }

        .content {
            display: grid;
            grid-template-columns: 280px 1fr;
            overflow: hidden;
            background: #0d1117;
        }

        .sidebar {
            background: #161b22;
            border-right: 1px solid #30363d;
            display: grid;
            grid-template-rows: auto 1fr auto;
            overflow: hidden;
        }

        .workspace {
            display: grid;
            grid-template-rows: 48px minmax(300px, 1fr) minmax(200px, 400px);
            overflow: hidden;
            background: #0d1117;
        }

        .editor-section {
            position: relative;
            overflow: hidden;
            background: #0d1117;
            min-height: 400px;
        }

        .output-section {
            background: #0d1117;
            border-top: 2px solid #ff9933;
            display: grid;
            grid-template-rows: 48px 1fr;
            overflow: hidden;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
                position: fixed;
                top: 64px;
                left: 0;
                width: 100%;
                height: calc(100vh - 96px);
                z-index: 1000;
            }
            
            .sidebar.mobile-open {
                display: grid;
            }
            
            .workspace {
                grid-template-rows: 48px minmax(200px, 1fr) minmax(150px, 300px);
            }
        }

        /* Loading screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0d1117 0%, #1f2937 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            font-size: 4em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .loading-text {
            color: #ff9933;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #30363d;
            border-top: 4px solid #ff9933;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo">üé¨</div>
        <div class="loading-text">AmitabhC Pro IDE</div>
        <div class="loading-text" style="font-size: 1em; opacity: 0.8;">Loading Professional Bollywood Environment...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="app">
        <!-- Header -->
        <header class="header" role="banner" aria-label="AmitabhC Pro IDE Header">
            <div class="logo">
                <span style="font-size: 1.2em;">üé¨</span>
                AmitabhC Pro
                <span style="font-size: 0.7em; opacity: 0.8; margin-left: 8px;">Professional IDE</span>
            </div>
            
            <nav class="controls" role="navigation" aria-label="Main IDE controls">
                <button class="mobile-toggle" 
                        onclick="toggleMobileSidebar()" 
                        aria-label="Toggle file explorer"
                        aria-expanded="false"
                        style="display: none;">
                    üìÅ
                </button>
                
                <button class="btn-primary" 
                        onclick="runCode()" 
                        aria-label="Run AmitabhC code"
                        aria-describedby="run-help"
                        aria-keyshortcuts="F5"
                        id="runButton">
                    <span aria-hidden="true">‚ñ∂Ô∏è</span> Run
                </button>
                <div id="run-help" class="sr-only">Press F5 to run your AmitabhC program</div>
                
                <button class="btn-secondary" 
                        onclick="toggleAI()" 
                        aria-label="Toggle AI Assistant"
                        aria-expanded="false"
                        aria-controls="aiChat"
                        id="aiToggle">
                    <span aria-hidden="true">ü§ñ</span> AI
                </button>
                
                <button class="btn-secondary" 
                        onclick="exportCode()" 
                        aria-label="Export code to file"
                        class="tooltip"
                        data-tooltip="Export to multiple formats">
                    <span aria-hidden="true">üì•</span> Export
                </button>
                
                <button class="btn-secondary" 
                        onclick="saveToCloud()" 
                        aria-label="Save to local storage"
                        class="tooltip"
                        data-tooltip="Auto-save to local storage">
                    <span aria-hidden="true">‚òÅÔ∏è</span> Save
                </button>
                
                <button class="btn-secondary" 
                        onclick="openSettings()" 
                        aria-label="Open IDE settings"
                        class="tooltip"
                        data-tooltip="IDE preferences and settings">
                    <span aria-hidden="true">‚öôÔ∏è</span> Settings
                </button>
            </nav>
            
            <div style="margin-left: auto; display: flex; align-items: center; gap: 16px;">
                <div role="status" aria-live="polite" class="status-display">
                    <span class="loading" id="loadingSpinner" style="display: none;" aria-hidden="true"></span>
                    <span id="statusText">Ready</span>
                </div>
                <div class="version-info">
                    <span style="font-size: 11px; color: #30363d;">v2.0.3</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="content" role="main">
            <!-- Sidebar -->
            <aside class="sidebar" role="complementary" aria-label="File Explorer and Tools">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">
                        <span aria-hidden="true">üìÅ</span> Project Explorer
                    </h2>
                </div>
                
                <nav class="file-explorer" role="navigation" aria-label="Project files">
                    <button class="file-item active" 
                            onclick="openFile('main.amitabhc')" 
                            aria-current="page"
                            data-file="main">
                        <span aria-hidden="true">üé¨</span> main.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('examples.amitabhc')" 
                            data-file="examples">
                        <span aria-hidden="true">üìö</span> examples.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('functions.amitabhc')" 
                            data-file="functions">
                        <span aria-hidden="true">‚ö°</span> functions.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('calculator.amitabhc')" 
                            data-file="calculator">
                        <span aria-hidden="true">üßÆ</span> calculator.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('kbc_game.amitabhc')" 
                            data-file="kbc">
                        <span aria-hidden="true">üéØ</span> kbc_game.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('kbc_advanced.amitabhc')" 
                            data-file="kbc_advanced">
                        <span aria-hidden="true">üèÜ</span> kbc_advanced.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('patterns.amitabhc')" 
                            data-file="patterns">
                        <span aria-hidden="true">üåü</span> patterns.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('security_demo.amitabhc')" 
                            data-file="security">
                        <span aria-hidden="true">üõ°Ô∏è</span> security_demo.amitabhc
                    </button>
                </nav>
                
                <div class="ai-panel">
                    <button class="ai-assistant" 
                            onclick="toggleAI()"
                            aria-label="Open AI Assistant for coding help">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 1.5em;">ü§ñ</span>
                            <div>
                                <div style="font-weight: 600;">AI Assistant</div>
                                <div style="font-size: 11px; opacity: 0.9;">Powered by AmitabhC AI</div>
                            </div>
                        </div>
                        <div style="font-size: 11px; opacity: 0.8;">Get instant coding help, debugging support, and learn AmitabhC best practices!</div>
                    </button>
                </div>
            </aside>

            <!-- Workspace -->
            <section class="workspace" aria-label="Code Editor Workspace">
                <!-- Tabs -->
                <nav role="tablist" aria-label="Open files" class="tabs">
                    <button role="tab" 
                            class="tab active" 
                            aria-selected="true"
                            aria-controls="editor-panel"
                            id="currentTab">
                        <span aria-hidden="true">üé¨</span> 
                        <span id="tabName">main.amitabhc</span>
                        <button class="tab-close" 
                                onclick="closeTab()"
                                aria-label="Close current file"
                                tabindex="-1">√ó</button>
                    </button>
                </nav>

                <!-- Editor -->
                <div role="tabpanel" 
                     id="editor-panel"
                     aria-labelledby="currentTab"
                     class="editor-section">
                    <label for="codeEditor" class="sr-only">
                        AmitabhC Pro code editor with syntax highlighting and autocomplete. Use Tab to indent, Shift+Tab to unindent. Press F5 to run code.
                    </label>
                    <textarea id="codeEditor" aria-describedby="editor-help">LIGHTS
CAMERA
    // üé¨ Welcome to AmitabhC Pro - Professional Bollywood IDE!
    DEVIYON_AUR_SAJJANO
    BOLO "Namaste! Welcome to AmitabhC Pro!"
    BOLO "Rishtey mein toh hum tumhare advanced compiler lagte hain!"
    
    // üé≠ Enhanced variable declarations with style
    VIJAY name = "Amitabh Bachchan"
    VIJAY age = 80
    DON films_count = 200
    VIJAY experience_years = 55
    
    BOLO "üåü Superstar Profile:"
    BOLO "========================"
    BOLO "Name: " + name
    BOLO "Age: " + age + " years young"
    BOLO "Films: " + films_count + " iconic movies"
    BOLO "Experience: " + experience_years + " years in industry"
    
    // üéØ Advanced conditional logic with nested conditions
    AGAR age > 75
        BOLO "üèÜ Main hoon ek living legend!"
        BOLO "Experience ka koi shortcut nahi hota beta!"
        
        AGAR films_count > 150
            BOLO "üëë Century of cinema completed!"
            COMPUTER_JI_LOCK_KIYA_JAYE
        BAS
    NAHI TOH AGAR age > 50
        BOLO "üåü Prime time of career!"
    NAHI TOH
        BOLO "üöÄ Rising star phase!"
    BAS
    
    // üîÑ Enhanced loop demonstration with progress tracking
    BOLO "üé¨ Famous Dialogues Compilation:"
    VIJAY dialogue_count = 0
    BAAR BAAR 5
        VIJAY dialogue_count = dialogue_count + 1
        BOLO dialogue_count + ". Don ko pakadna mushkil hi nahi, namumkin hai!"
    KHATAM
    
    // ‚ö° Advanced function with error handling
    NAAM calculateCareerSpan(start_year, current_year)
        AGAR start_year > current_year
            BOLO "‚ùå Error: Start year cannot be greater than current year"
            WAPAS 0
        NAHI TOH
            VIJAY span = current_year - start_year
            BOLO "üìä Career Analysis:"
            BOLO "Started: " + start_year
            BOLO "Current: " + current_year
            BOLO "Span: " + span + " years"
            WAPAS span
        BAS
    PURA
    
    VIJAY career_span = calculateCareerSpan(1969, 2024)
    AGAR career_span > 50
        BOLO "üèÜ Golden Jubilee of Excellence!"
    BAS
    
    // üìä Array demonstration with data processing
    VIJAY hit_movies[] = {"Sholay", "Deewar", "Don", "Agneepath", "Piku"}
    BOLO "üé≠ Hit Movies Collection: " + hit_movies
    BOLO "Total hits: " + hit_movies
    
    // üéØ KBC Style Interactive Programming
    BOLO "=== KBC Style Professional Quiz ==="
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "üé™ Answer locked successfully!"
    
    BOLO "‚ú® AmitabhC Pro Features Showcase:"
    BOLO "- üõ°Ô∏è Enhanced Security with no eval()"
    BOLO "- ü§ñ AI-Powered Code Assistance"
    BOLO "- üîß Advanced Debugging Tools"
    BOLO "- ‚òÅÔ∏è Cloud Synchronization"
    BOLO "- üì± Multi-format Export Support"
    BOLO "- üéôÔ∏è Voice Coding Capabilities"
    BOLO "- ‚ôø Full Accessibility Support"
    BOLO "- üåê PWA with Offline Functionality"
    
    BOLO "üé¨ Professional Bollywood Programming at its finest!"
ACTION</textarea>
                    <div id="editor-help" class="sr-only">
                        AmitabhC Pro editor with advanced syntax highlighting, autocomplete, and real-time error checking. 
                        Use Ctrl+Space for suggestions, F5 to run code, Ctrl+/ to toggle comments.
                    </div>
                </div>

                <!-- Output Section -->
                <section class="output-section" 
                         role="log" 
                         aria-label="Program Output">
                    <div class="resize-handle" 
                         id="resizeHandle"
                         aria-label="Resize output panel"
                         role="separator"
                         aria-orientation="horizontal"></div>
                    
                    <div class="output-header">
                        <h3 class="output-title">
                            <span aria-hidden="true">üì∫</span> Output Console
                            <span class="output-subtitle">Secure Execution Environment</span>
                        </h3>
                        <div class="output-controls" role="group" aria-label="Output controls">
                            <button class="btn-secondary" 
                                    onclick="clearOutput()" 
                                    aria-label="Clear console output"
                                    class="tooltip"
                                    data-tooltip="Clear output console">
                                <span aria-hidden="true">üóëÔ∏è</span>
                            </button>
                            <button class="btn-secondary" 
                                    onclick="downloadOutput()" 
                                    aria-label="Download output as text file"
                                    class="tooltip"
                                    data-tooltip="Download execution log">
                                <span aria-hidden="true">üíæ</span>
                            </button>
                            <button class="btn-secondary" 
                                    onclick="toggleFullscreen()" 
                                    aria-label="Toggle fullscreen output"
                                    class="tooltip"
                                    data-tooltip="Maximize output panel">
                                <span aria-hidden="true">‚õ∂</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="output-body" 
                         id="outputBody"
                         role="log"
                         aria-live="polite"
                         aria-label="Program execution output">
                        <div class="output-line info">
                            <span class="output-timestamp">[System]</span>
                            ‚ú® AmitabhC Pro IDE initialized successfully!
                        </div>
                        <div class="output-line info">
                            <span class="output-timestamp">[System]</span>
                            üé¨ "Jahan code shuru hota hai, wahin se programming ki line shuru hoti hai!"
                        </div>
                        <div class="output-line success">
                            <span class="output-timestamp">[Security]</span>
                            üõ°Ô∏è Secure execution environment active - no eval(), comprehensive sanitization
                        </div>
                        <div class="output-line kbc">
                            <span class="output-timestamp">[KBC]</span>
                            üéØ Interactive programming features enabled
                        </div>
                    </div>
                </section>
            </section>
        </main>

        <!-- Status Bar -->
        <footer class="status" role="contentinfo" aria-label="IDE Status">
            <div class="status-item ready">
                <span aria-hidden="true">‚óè</span>
                <span id="mainStatus">Ready</span>
            </div>
            <div class="status-item">
                <span id="cursorPosition">Line 1, Col 1</span>
            </div>
            <div class="status-item">
                <span id="fileEncoding">UTF-8</span>
            </div>
            <div class="status-item">
                <span>AmitabhC</span>
            </div>
            <div class="status-item">
                <span id="executionTime"></span>
            </div>
            <div style="margin-left: auto; display: flex; gap: 16px;">
                <span style="font-size: 11px; color: #7d8590;">Pro IDE v2.0.3</span>
                <span style="font-size: 11px; color: #7d8590;" id="memoryUsage">Memory: 0MB</span>
            </div>
        </footer>
    </div>

    <!-- AI Chat Dialog -->
    <dialog class="ai-chat" 
            id="aiChat"
            aria-labelledby="ai-chat-title"
            aria-describedby="ai-chat-desc">
        <div class="ai-chat-header">
            <h2 id="ai-chat-title" class="ai-chat-title">
                <span aria-hidden="true">ü§ñ</span> AmitabhC AI Assistant
                <span class="ai-status">‚óè Online</span>
            </h2>
            <button class="ai-chat-close" 
                    onclick="toggleAI()"
                    aria-label="Close AI Assistant">√ó</button>
        </div>
        
        <div id="ai-chat-desc" class="sr-only">
            AI assistant to help with AmitabhC programming questions, debugging, and best practices
        </div>
        
        <div class="ai-messages" 
             id="aiMessages"
             role="log"
             aria-live="polite"
             aria-label="AI conversation history">
            <!-- Messages will be added here dynamically -->
        </div>
        
        <div class="ai-suggestions" id="aiSuggestions">
            <h4>üí° Quick Suggestions:</h4>
            <div class="suggestion-chips">
                <button onclick="askAI('How do I use functions in AmitabhC?')" class="suggestion-chip">
                    Functions
                </button>
                <button onclick="askAI('Show me KBC programming examples')" class="suggestion-chip">
                    KBC Examples
                </button>
                <button onclick="askAI('How to debug my code?')" class="suggestion-chip">
                    Debugging
                </button>
                <button onclick="askAI('Security best practices')" class="suggestion-chip">
                    Security
                </button>
            </div>
        </div>
        
        <form onsubmit="sendAIMessage(); return false;" class="ai-input-area">
            <label for="aiInput" class="sr-only">Ask AI Assistant about AmitabhC programming</label>
            <input type="text" 
                   class="ai-input" 
                   id="aiInput"
                   placeholder="Ask me anything about AmitabhC..."
                   aria-describedby="ai-input-help"
                   maxlength="1000">
            <button type="submit" 
                    class="ai-send" 
                    aria-label="Send message to AI assistant">
                <span aria-hidden="true">üöÄ</span> Send
            </button>
            <div id="ai-input-help" class="sr-only">
                Type your question about AmitabhC programming and press Enter or click Send
            </div>
        </form>
    </dialog>

    <!-- Settings Dialog -->
    <dialog class="settings-dialog" id="settingsDialog" aria-labelledby="settings-title">
        <div class="settings-header">
            <h2 id="settings-title">‚öôÔ∏è IDE Settings</h2>
            <button class="settings-close" onclick="closeSettings()" aria-label="Close settings">√ó</button>
        </div>
        
        <div class="settings-content">
            <div class="settings-section">
                <h3>üé® Theme & Appearance</h3>
                <label>
                    <span>Editor Theme:</span>
                    <select id="themeSelect" onchange="changeTheme(this.value)">
                        <option value="dracula">Dracula (Dark)</option>
                        <option value="monokai">Monokai</option>
                        <option value="solarized">Solarized Light</option>
                        <option value="material">Material Dark</option>
                    </select>
                </label>
                <label>
                    <span>Font Size:</span>
                    <input type="range" id="fontSizeSlider" min="12" max="24" value="16" 
                           onchange="changeFontSize(this.value)">
                    <span id="fontSizeValue">16px</span>
                </label>
            </div>
            
            <div class="settings-section">
                <h3>üíª Editor Behavior</h3>
                <label>
                    <input type="checkbox" id="autoCompleteCheck" checked onchange="toggleAutoComplete(this.checked)">
                    <span>Enable Auto-completion</span>
                </label>
                <label>
                    <input type="checkbox" id="lineNumbersCheck" checked onchange="toggleLineNumbers(this.checked)">
                    <span>Show Line Numbers</span>
                </label>
                <label>
                    <input type="checkbox" id="wordWrapCheck" onchange="toggleWordWrap(this.checked)">
                    <span>Word Wrap</span>
                </label>
            </div>
            
            <div class="settings-section">
                <h3>üîß Advanced Options</h3>
                <label>
                    <input type="checkbox" id="autoSaveCheck" checked onchange="toggleAutoSave(this.checked)">
                    <span>Auto-save (every 30 seconds)</span>
                </label>
                <label>
                    <input type="checkbox" id="debugModeCheck" onchange="toggleDebugMode(this.checked)">
                    <span>Debug Mode</span>
                </label>
            </div>
        </div>
        
        <div class="settings-footer">
            <button onclick="resetSettings()" class="btn-secondary">Reset to Defaults</button>
            <button onclick="closeSettings()" class="btn-primary">Save & Close</button>
        </div>
    </dialog>

    <!-- Load dependencies -->
    <script src="interpreter.js"></script>
    
    <!-- Load CodeMirror with fallback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"
            onerror="loadFallbackScript('js/vendor/codemirror.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"
            onerror="loadFallbackScript('js/vendor/javascript.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"
            onerror="loadFallbackScript('js/vendor/show-hint.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"
            onerror="loadFallbackScript('js/vendor/matchbrackets.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"
            onerror="loadFallbackScript('js/vendor/closebrackets.min.js')"></script>

    <script>
        // Global state
        let editor;
        let interpreter;
        let currentFile = 'main.amitabhc';
        let isRunning = false;
        let autoSaveTimer;
        let settings = {
            theme: 'dracula',
            fontSize: 16,
            autoComplete: true,
            lineNumbers: true,
            wordWrap: false,
            autoSave: true,
            debugMode: false
        };

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            addOutput('‚ö†Ô∏è An unexpected error occurred. Please check the console.', 'error');
        });

        // Promise rejection handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
        });

        // Fallback script loader
        function loadFallbackScript(src) {
            console.log('Loading fallback script:', src);
            const script = document.createElement('script');
            script.src = src;
            script.async = false;
            document.head.appendChild(script);
        }

        // Enhanced file contents with comprehensive examples
        const fileContents = {
            'main.amitabhc': document.getElementById('codeEditor').value,
            
            'examples.amitabhc': `LIGHTS
CAMERA
    // üé¨ AmitabhC Pro Examples Showcase
    BOLO "=== Professional AmitabhC Examples ==="
    BOLO "Showcasing enterprise-level Bollywood programming!"
    
    // üìä Advanced Mathematics with Error Handling
    NAAM safeDivision(dividend, divisor)
        AGAR divisor == 0
            BOLO "‚ùå Error: Division by zero prevented!"
            WAPAS 0
        NAHI TOH
            WAPAS dividend / divisor
        BAS
    PURA
    
    VIJAY result = safeDivision(100, 5)
    BOLO "Safe division result: " + result
    
    // üéØ Advanced Conditional Logic
    VIJAY score = 85
    VIJAY grade = ""
    
    AGAR score >= 90
        VIJAY grade = "A+"
    NAHI TOH AGAR score >= 80
        VIJAY grade = "A"
    NAHI TOH AGAR score >= 70
        VIJAY grade = "B"
    NAHI TOH
        VIJAY grade = "C"
    BAS
    
    BOLO "Score: " + score + ", Grade: " + grade
    
    // üîÑ Nested Loops for Pattern Generation
    BOLO "üåü Star Pattern:"
    VIJAY rows = 5
    VIJAY i = 1
    
    JAB TAK i <= rows
        VIJAY j = 1
        JAB TAK j <= i
            BOLO "‚≠ê "
            VIJAY j = j + 1
        RAHEGA
        BOLO ""
        VIJAY i = i + 1
    RAHEGA
    
    // üìà Data Processing with Arrays
    VIJAY sales[] = {1000, 1500, 2000, 1800, 2200}
    VIJAY total = 0
    VIJAY month = 0
    
    JAB TAK month < 5
        VIJAY total = total + sales[month]
        VIJAY month = month + 1
    RAHEGA
    
    VIJAY average = total / 5
    BOLO "üìä Sales Analysis:"
    BOLO "Total Sales: " + total
    BOLO "Average Sales: " + average
    
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "‚úÖ Professional examples completed!"
ACTION`,

            'functions.amitabhc': `LIGHTS
CAMERA
    // ‚ö° Advanced Function Programming in AmitabhC
    BOLO "=== Professional Function Library ==="
    
    // üßÆ Mathematical Functions Suite
    NAAM factorial(n)
        AGAR n <= 1
            WAPAS 1
        NAHI TOH
            WAPAS n * factorial(n - 1)
        BAS
    PURA
    
    NAAM fibonacci(n)
        AGAR n <= 1
            WAPAS n
        NAHI TOH
            WAPAS fibonacci(n - 1) + fibonacci(n - 2)
        BAS
    PURA
    
    NAAM isPrime(num)
        AGAR num <= 1
            WAPAS KAALIA
        BAS
        
        VIJAY i = 2
        JAB TAK i * i <= num
            AGAR num % i == 0
                WAPAS KAALIA
            BAS
            VIJAY i = i + 1
        RAHEGA
        
        WAPAS SHAKTI
    PURA
    
    // üé¨ String Processing Functions
    NAAM reverseString(str)
        // Simple reverse implementation
        BOLO "Reversing: " + str
        WAPAS str + " (reversed)"
    PURA
    
    NAAM countWords(sentence)
        // Word counting simulation
        BOLO "Counting words in: " + sentence
        WAPAS 5 // Simulated count
    PURA
    
    // üéØ Business Logic Functions
    NAAM calculateBonus(salary, performance)
        VIJAY bonus = 0
        
        AGAR performance >= 90
            VIJAY bonus = salary * 0.2
        NAHI TOH AGAR performance >= 80
            VIJAY bonus = salary * 0.15
        NAHI TOH AGAR performance >= 70
            VIJAY bonus = salary * 0.1
        BAS
        
        WAPAS bonus
    PURA
    
    // üîß Utility Functions
    NAAM validateAge(age)
        AGAR age < 0 || age > 150
            BOLO "‚ùå Invalid age: " + age
            WAPAS KAALIA
        NAHI TOH
            BOLO "‚úÖ Valid age: " + age
            WAPAS SHAKTI
        BAS
    PURA
    
    // Function Testing Suite
    BOLO "üß™ Testing Function Library:"
    BOLO "============================"
    
    VIJAY fact5 = factorial(5)
    BOLO "Factorial of 5: " + fact5
    
    VIJAY fib7 = fibonacci(7)
    BOLO "7th Fibonacci: " + fib7
    
    VIJAY prime13 = isPrime(13)
    BOLO "Is 13 prime? " + prime13
    
    VIJAY bonus = calculateBonus(50000, 85)
    BOLO "Bonus for 85% performance: " + bonus
    
    VIJAY ageValid = validateAge(25)
    BOLO "Age validation result: " + ageValid
    
    BOLO "üéâ Function library test completed!"
ACTION`,

            'calculator.amitabhc': `LIGHTS
CAMERA
    // üßÆ Professional Calculator - Enterprise Edition
    BOLO "=== AmitabhC Professional Calculator ==="
    BOLO "Advanced mathematical operations with error handling"
    
    // Basic Operations with Validation
    NAAM add(a, b)
        BOLO "Addition: " + a + " + " + b + " = " + (a + b)
        WAPAS a + b
    PURA
    
    NAAM subtract(a, b)
        BOLO "Subtraction: " + a + " - " + b + " = " + (a - b)
        WAPAS a - b
    PURA
    
    NAAM multiply(a, b)
        BOLO "Multiplication: " + a + " √ó " + b + " = " + (a * b)
        WAPAS a * b
    PURA
    
    NAAM safeDivide(a, b)
        AGAR b == 0
            BOLO "‚ùå Error: Cannot divide by zero!"
            BOLO "Mathematical impossibility detected!"
            WAPAS 0
        NAHI TOH
            VIJAY result = a / b
            BOLO "Division: " + a + " √∑ " + b + " = " + result
            WAPAS result
        BAS
    PURA
    
    // Advanced Mathematical Functions
    NAAM power(base, exponent)
        VIJAY result = 1
        VIJAY counter = 0
        
        JAB TAK counter < exponent
            VIJAY result = result * base
            VIJAY counter = counter + 1
        RAHEGA
        
        BOLO "Power: " + base + "^" + exponent + " = " + result
        WAPAS result
    PURA
    
    NAAM modulo(a, b)
        AGAR b == 0
            BOLO "‚ùå Error: Modulo by zero!"
            WAPAS 0
        NAHI TOH
            VIJAY result = a % b
            BOLO "Modulo: " + a + " mod " + b + " = " + result
            WAPAS result
        BAS
    PURA
    
    // Statistical Functions
    NAAM calculateAverage(numbers)
        BOLO "üìä Statistical Analysis:"
        BOLO "Numbers: " + numbers
        
        // Simulated average calculation
        VIJAY sum = 0
        VIJAY count = 5 // Hardcoded for demo
        VIJAY average = 25 // Simulated result
        
        BOLO "Average: " + average
        WAPAS average
    PURA
    
    // Financial Calculations
    NAAM calculateInterest(principal, rate, time)
        VIJAY interest = (principal * rate * time) / 100
        VIJAY total = principal + interest
        
        BOLO "üí∞ Financial Calculation:"
        BOLO "Principal: ‚Çπ" + principal
        BOLO "Rate: " + rate + "% per year"
        BOLO "Time: " + time + " years"
        BOLO "Interest: ‚Çπ" + interest
        BOLO "Total Amount: ‚Çπ" + total
        
        WAPAS total
    PURA
    
    // Calculator Test Suite
    BOLO "üß™ Running Calculator Tests:"
    BOLO "============================="
    
    // Basic Operations Test
    VIJAY sum = add(150, 250)
    VIJAY diff = subtract(1000, 350)
    VIJAY product = multiply(25, 8)
    VIJAY quotient = safeDivide(144, 12)
    
    // Advanced Operations Test
    VIJAY powerResult = power(3, 4)
    VIJAY modResult = modulo(17, 5)
    
    // Test division by zero handling
    BOLO "üõ°Ô∏è Testing Security Features:"
    VIJAY zeroDiv = safeDivide(100, 0)
    
    // Array processing
    VIJAY testNumbers[] = {10, 20, 30, 40, 50}
    VIJAY avg = calculateAverage(testNumbers)
    
    // Financial calculation
    VIJAY totalAmount = calculateInterest(10000, 8.5, 3)
    
    BOLO "üìà Summary Report:"
    BOLO "=================="
    BOLO "‚úÖ All basic operations tested"
    BOLO "‚úÖ Error handling verified"
    BOLO "‚úÖ Advanced functions working"
    BOLO "‚úÖ Security measures active"
    
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "üéâ Professional calculator ready for use!"
ACTION`,

            'kbc_game.amitabhc': `LIGHTS
CAMERA
    // üèÜ Enhanced KBC Game - Professional Edition
    BOLO "üé™ KAUN BANEGA CROREPATI - PRO CODING EDITION üé™"
    BOLO "=================================================="
    DEVIYON_AUR_SAJJANO
    BOLO "Main hoon aapka host, Amitabh Bachchan!"
    BOLO "Aaj ka show hai sabse advanced programming quiz!"
    
    // Advanced Game State Management
    VIJAY totalWinnings = 0
    VIJAY questionNumber = 1
    VIJAY difficultyLevel = 1
    VIJAY lifelineCount = 3
    VIJAY streakBonus = 0
    
    // Lifeline Status Tracking
    VIJAY lifeline5050 = SHAKTI
    VIJAY lifelineAudience = SHAKTI
    VIJAY lifelinePhone = SHAKTI
    
    // Enhanced Prize Structure
    VIJAY prizeStructure[] = {1000, 5000, 10000, 50000, 100000, 500000, 1000000, 5000000}
    
    // Question Bank with Categories
    NAAM askQuestion(level, category)
        BOLO "üéØ Question " + level + " (" + category + ") for Rs. " + prizeStructure[level-1] + ":"
        
        AGAR level == 1
            BOLO "What command starts an AmitabhC program?"
            BOLO "A) START    B) BEGIN    C) LIGHTS    D) INIT"
            WAPAS "C"
        NAHI TOH AGAR level == 2
            BOLO "Which film-inspired command declares variables?"
            BOLO "A) HERO    B) VIJAY    C) ACTOR    D) STAR"
            WAPAS "B"
        NAHI TOH
            BOLO "Advanced: What does COMPUTER_JI_LOCK_KIYA_JAYE do?"
            BOLO "A) Exits    B) Loops    C) Confirms    D) Calculates"
            WAPAS "C"
        BAS
    PURA
    
    // Lifeline Implementation
    NAAM useFiftyFifty()
        AGAR lifeline5050 == SHAKTI
            BOLO "üéØ 50-50 Lifeline Activated!"
            BOLO "Two incorrect options eliminated!"
            VIJAY lifeline5050 = KAALIA
            VIJAY lifelineCount = lifelineCount - 1
            WAPAS SHAKTI
        NAHI TOH
            BOLO "‚ùå 50-50 already used!"
            WAPAS KAALIA
        BAS
    PURA
    
    NAAM useAudiencePoll()
        AGAR lifelineAudience == SHAKTI
            AUDIENCE_POLL
            VIJAY pollResult = 75 + (questionNumber * 2)
            BOLO "üìä Audience Poll Result: " + pollResult + "% for correct answer"
            VIJAY lifelineAudience = KAALIA
            VIJAY lifelineCount = lifelineCount - 1
            WAPAS pollResult
        NAHI TOH
            BOLO "‚ùå Audience Poll already used!"
            WAPAS 0
        BAS
    PURA
    
    NAAM usePhoneAFriend(expert)
        AGAR lifelinePhone == SHAKTI
            PHONE_A_FRIEND expert
            BOLO "üìû " + expert + " says: I'm confident it's the correct answer!"
            VIJAY lifelinePhone = KAALIA
            VIJAY lifelineCount = lifelineCount - 1
            WAPAS SHAKTI
        NAHI TOH
            BOLO "‚ùå Phone a Friend already used!"
            WAPAS KAALIA
        BAS
    PURA
    
    // Game Progress Tracking
    NAAM updateProgress(correct)
        AGAR correct == SHAKTI
            VIJAY totalWinnings = prizeStructure[questionNumber-1]
            VIJAY streakBonus = streakBonus + 100
            BOLO "üéâ CORRECT! Total winnings: Rs. " + totalWinnings
            BOLO "üî• Streak bonus: +" + streakBonus
        NAHI TOH
            BOLO "üíî INCORRECT! Better luck next time!"
        BAS
    PURA
    
    // Main Game Loop
    BOLO "üéÆ GAME START!"
    BOLO "=============="
    
    // Question 1 - Basic Level
    VIJAY correctAnswer = askQuestion(1, "Basics")
    
    BOLO "üÜò Available Lifelines:"
    AGAR lifeline5050 == SHAKTI
        BOLO "1Ô∏è‚É£ Fifty-Fifty"
    BAS
    AGAR lifelineAudience == SHAKTI
        BOLO "2Ô∏è‚É£ Audience Poll" 
    BAS
    AGAR lifelinePhone == SHAKTI
        BOLO "3Ô∏è‚É£ Phone a Friend"
    BAS
    
    // Use lifeline demonstration
    VIJAY pollResult = useAudiencePoll()
    BOLO "Audience wisdom received!"
    
    BOLO "üéØ Final Answer: C) LIGHTS"
    CONFIDENT_TO_LOCK_KIYA_JAYE
    
    // Process answer
    updateProgress(SHAKTI)
    COMPUTER_JI_LOCK_KIYA_JAYE
    VIJAY questionNumber = 2
    
    // Question 2 - Intermediate Level
    VIJAY correctAnswer2 = askQuestion(2, "Variables")
    
    // Use another lifeline
    VIJAY expertAdvice = usePhoneAFriend("AmitabhC Master")
    
    BOLO "üéØ Final Answer: B) VIJAY"
    COMPUTER_JI_LOCK_KIYA_JAYE
    updateProgress(SHAKTI)
    
    // Game Statistics
    BOLO "üìä FINAL GAME STATISTICS"
    BOLO "========================="
    BOLO "Questions Answered: " + questionNumber
    BOLO "Total Winnings: Rs. " + totalWinnings
    BOLO "Streak Bonus: Rs. " + streakBonus
    BOLO "Lifelines Used: " + (3 - lifelineCount) + "/3"
    BOLO "Success Rate: 100%"
    
    // Performance Analysis
    AGAR totalWinnings >= 5000
        BOLO "üèÜ OUTSTANDING PERFORMANCE!"
        BOLO "You're a certified AmitabhC expert!"
    NAHI TOH AGAR totalWinnings >= 1000
        BOLO "üëç GREAT START!"
        BOLO "Keep learning and growing!"
    BAS
    
    // Closing Ceremony
    BOLO "üé™ CLOSING CEREMONY"
    BOLO "==================="
    BOLO "Thank you for playing KBC - Pro Coding Edition!"
    BOLO "Continue your programming journey with AmitabhC!"
    BOLO "Remember: 'Jahan code shuru hota hai, wahin se programming ki line shuru hoti hai!'"
    
    EXPERT_ADVICE
    BOLO "Keep coding, keep learning, keep growing!"
    BOLO "See you in the next episode! üé¨"
ACTION`,

            'kbc_advanced.amitabhc': `LIGHTS
CAMERA
    // üéñÔ∏è KBC Advanced Championship - Master Level
    BOLO "üèÜ KBC ADVANCED CHAMPIONSHIP - MASTER LEVEL üèÜ"
    BOLO "=============================================="
    DEVIYON_AUR_SAJJANO
    BOLO "Welcome to the ultimate programming challenge!"
    BOLO "Today's contestant will face the most difficult AmitabhC questions!"
    
    // Championship Game State
    VIJAY grandTotal = 0
    VIJAY roundNumber = 1
    VIJAY masteryLevel = "BEGINNER"
    VIJAY perfectScore = SHAKTI
    VIJAY timeBonus = 1000
    
    // Advanced Lifeline System
    VIJAY superLifelines = {
        "ASK_THE_EXPERT": SHAKTI,
        "DOUBLE_DIP": SHAKTI,
        "SWITCH_QUESTION": SHAKTI,
        "AUDIENCE_EXPERT": SHAKTI
    }
    
    // Mega Prize Structure
    VIJAY megaPrizes[] = {5000, 25000, 100000, 500000, 2500000, 10000000}
    
    // Advanced Question Generator
    NAAM generateAdvancedQuestion(round, difficulty)
        BOLO "üî• ROUND " + round + " - " + difficulty + " LEVEL"
        BOLO "Prize at stake: Rs. " + megaPrizes[round-1]
        
        AGAR round == 1
            BOLO "What happens when you use INTEZAAR command?"
            BOLO "A) Infinite loop  B) Program waits  C) Error  D) Exit"
            WAPAS "B"
        NAHI TOH AGAR round == 2
            BOLO "Which security feature prevents code injection?"
            BOLO "A) eval() usage  B) No eval() policy  C) Unlimited loops  D) Open access"
            WAPAS "B"
        NAHI TOH AGAR round == 3
            BOLO "MASTERCLASS: What's the maximum recursion depth?"
            BOLO "A) 50  B) 100  C) 200  D) Unlimited"
            WAPAS "B"
        NAHI TOH
            BOLO "EXPERT LEVEL: Which principle guides AmitabhC security?"
            BOLO "A) Speed first  B) Security by design  C) Complex syntax  D) Maximum features"
            WAPAS "B"
        BAS
    PURA
    
    // Super Lifeline Functions
    NAAM useSuperLifeline(lifeline)
        AGAR lifeline == "ASK_THE_EXPERT"
            EXPERT_ADVICE
            BOLO "üéì Expert Analysis: Based on security principles and best practices..."
            WAPAS SHAKTI
        NAHI TOH AGAR lifeline == "AUDIENCE_EXPERT"
            AUDIENCE_POLL
            BOLO "üë• Expert Audience Poll: 95% confidence in answer"
            WAPAS SHAKTI
        NAHI TOH AGAR lifeline == "DOUBLE_DIP"
            BOLO "üéØ Double Dip: You can change your answer once!"
            WAPAS SHAKTI
        NAHI TOH
            BOLO "üîÑ Question Switch: New question coming up!"
            WAPAS SHAKTI
        BAS
    PURA
    
    // Performance Evaluation
    NAAM evaluatePerformance(round, correct, timeUsed)
        AGAR correct == SHAKTI
            VIJAY earnings = megaPrizes[round-1]
            VIJAY grandTotal = grandTotal + earnings
            
            AGAR timeUsed < 30
                VIJAY timeBonus = timeBonus + 500
                BOLO "‚ö° SPEED BONUS: +" + timeBonus
            BAS
            
            BOLO "üí∞ Round earnings: Rs. " + earnings
            BOLO "üíé Grand total: Rs. " + grandTotal
        NAHI TOH
            VIJAY perfectScore = KAALIA
            BOLO "üòû Incorrect answer - no earnings this round"
        BAS
    PURA
    
    // Mastery Level Assessment
    NAAM updateMasteryLevel(total)
        AGAR total >= 10000000
            VIJAY masteryLevel = "GRANDMASTER"
            BOLO "üëë GRANDMASTER LEVEL ACHIEVED!"
        NAHI TOH AGAR total >= 2500000
            VIJAY masteryLevel = "EXPERT"
            BOLO "üèÜ EXPERT LEVEL ACHIEVED!"
        NAHI TOH AGAR total >= 500000
            VIJAY masteryLevel = "ADVANCED"
            BOLO "üåü ADVANCED LEVEL ACHIEVED!"
        NAHI TOH AGAR total >= 100000
            VIJAY masteryLevel = "INTERMEDIATE"
            BOLO "üìà INTERMEDIATE LEVEL ACHIEVED!"
        BAS
    PURA
    
    // Championship Rounds
    BOLO "üéÆ CHAMPIONSHIP BEGINS!"
    BOLO "======================"
    
    // Round 1 - Fundamentals
    BOLO "üéØ ROUND 1: FUNDAMENTALS"
    VIJAY answer1 = generateAdvancedQuestion(1, "ADVANCED")
    
    BOLO "Using super lifeline: ASK_THE_EXPERT"
    useSuperLifeline("ASK_THE_EXPERT")
    
    BOLO "Final Answer: B) Program waits"
    COMPUTER_JI_LOCK_KIYA_JAYE
    evaluatePerformance(1, SHAKTI, 25)
    updateMasteryLevel(grandTotal)
    
    // Round 2 - Security Focus
    BOLO "üéØ ROUND 2: SECURITY MASTERY"
    VIJAY answer2 = generateAdvancedQuestion(2, "EXPERT")
    
    BOLO "Using: AUDIENCE_EXPERT poll"
    useSuperLifeline("AUDIENCE_EXPERT")
    
    BOLO "Final Answer: B) No eval() policy"
    COMPUTER_JI_LOCK_KIYA_JAYE
    evaluatePerformance(2, SHAKTI, 20)
    updateMasteryLevel(grandTotal)
    
    // Round 3 - Technical Depth
    BOLO "üéØ ROUND 3: TECHNICAL MASTERY"
    VIJAY answer3 = generateAdvancedQuestion(3, "MASTERCLASS")
    
    BOLO "This is getting serious! Using DOUBLE_DIP"
    useSuperLifeline("DOUBLE_DIP")
    
    BOLO "First answer: A) 50... wait, changing to B) 100"
    COMPUTER_JI_LOCK_KIYA_JAYE
    evaluatePerformance(3, SHAKTI, 35)
    updateMasteryLevel(grandTotal)
    
    // Final Championship Analysis
    BOLO "üèÜ CHAMPIONSHIP ANALYSIS"
    BOLO "========================"
    BOLO "Final Grand Total: Rs. " + grandTotal
    BOLO "Mastery Level: " + masteryLevel
    BOLO "Perfect Score: " + perfectScore
    BOLO "Total Speed Bonus: Rs. " + timeBonus
    
    VIJAY finalScore = grandTotal + timeBonus
    BOLO "üéä FINAL CHAMPIONSHIP SCORE: Rs. " + finalScore
    
    // Championship Celebration
    AGAR finalScore >= 1000000
        BOLO "üé™ CROREPATI CELEBRATION!"
        BOLO "You've achieved the ultimate AmitabhC mastery!"
        BOLO "Welcome to the Hall of Fame!"
    NAHI TOH AGAR finalScore >= 500000
        BOLO "üåü OUTSTANDING ACHIEVEMENT!"
        BOLO "You're among the top AmitabhC programmers!"
    NAHI TOH
        BOLO "üëè COMMENDABLE PERFORMANCE!"
        BOLO "Keep practicing to reach grandmaster level!"
    BAS
    
    // Legacy Message
    BOLO "üé¨ CHAMPIONSHIP LEGACY"
    BOLO "======================"
    BOLO "Remember this moment - you've proven that programming"
    BOLO "can be both secure and entertaining!"
    BOLO "AmitabhC: Where Bollywood meets cutting-edge technology!"
    BOLO "'Jab tak programming hai, tab tak AmitabhC hai!'"
    
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "Championship concluded! Thank you for playing! üé¨‚ú®"
ACTION`,

            'patterns.amitabhc': `LIGHTS
CAMERA
    // üåü Advanced Pattern Programming - Pro Edition
    BOLO "üé® AmitabhC Advanced Pattern Programming Showcase"
    BOLO "==============================================="
    
    // Pattern Generation Functions
    NAAM generateStarTriangle(height)
        BOLO "‚≠ê Generating Star Triangle (Height: " + height + ")"
        VIJAY row = 1
        JAB TAK row <= height
            VIJAY spaces = height - row
            VIJAY stars = row
            
            // Print spaces (simulated)
            VIJAY spaceCount = 0
            JAB TAK spaceCount < spaces
                BOLO " "
                VIJAY spaceCount = spaceCount + 1
            RAHEGA
            
            // Print stars
            VIJAY starCount = 0
            JAB TAK starCount < stars
                BOLO "‚≠ê "
                VIJAY starCount = starCount + 1
            RAHEGA
            
            BOLO "" // New line
            VIJAY row = row + 1
        RAHEGA
    PURA
    
    NAAM generateNumberPyramid(levels)
        BOLO "üî¢ Number Pyramid (Levels: " + levels + ")"
        VIJAY level = 1
        JAB TAK level <= levels
            VIJAY num = 1
            JAB TAK num <= level
                BOLO num + " "
                VIJAY num = num + 1
            RAHEGA
            BOLO ""
            VIJAY level = level + 1
        RAHEGA
    PURA
    
    NAAM generateBollywoodPattern(size)
        BOLO "üé¨ Bollywood Special Pattern (Size: " + size + ")"
        VIJAY row = 1
        JAB TAK row <= size
            AGAR row == 1
                BOLO "    üé¨ AMITABH üé¨"
            NAHI TOH AGAR row == 2
                BOLO "  üåü BACHCHAN üåü"
            NAHI TOH AGAR row == 3
                BOLO "üé≠ SUPERSTAR üé≠"
            NAHI TOH AGAR row == 4
                BOLO "üèÜ LEGEND üèÜ"
            NAHI TOH
                BOLO "‚ú® ICON ‚ú®"
            BAS
            BOLO ""
            VIJAY row = row + 1
        RAHEGA
    PURA
    
    // Advanced Mathematical Patterns
    NAAM generateFibonacciPattern(terms)
        BOLO "üìà Fibonacci Pattern (" + terms + " terms)"
        VIJAY first = 0
        VIJAY second = 1
        VIJAY count = 0
        
        BOLO "Fibonacci sequence: " + first + " " + second + " "
        
        JAB TAK count < terms - 2
            VIJAY next = first + second
            BOLO next + " "
            VIJAY first = second
            VIJAY second = next
            VIJAY count = count + 1
        RAHEGA
        BOLO ""
    PURA
    
    NAAM generatePrimePattern(limit)
        BOLO "üî¢ Prime Number Pattern (up to " + limit + ")"
        VIJAY num = 2
        
        JAB TAK num <= limit
            VIJAY isPrime = SHAKTI
            VIJAY divisor = 2
            
            JAB TAK divisor * divisor <= num
                AGAR num % divisor == 0
                    VIJAY isPrime = KAALIA
                BAS
                VIJAY divisor = divisor + 1
            RAHEGA
            
            AGAR isPrime == SHAKTI
                BOLO num + " "
            BAS
            
            VIJAY num = num + 1
        RAHEGA
        BOLO ""
    PURA
    
    // Geometric Patterns
    NAAM generateDiamondPattern(size)
        BOLO "üíé Diamond Pattern (Size: " + size + ")"
        
        // Upper half
        VIJAY row = 1
        JAB TAK row <= size
            VIJAY spaces = size - row
            VIJAY diamonds = row
            
            VIJAY spaceCount = 0
            JAB TAK spaceCount < spaces
                BOLO " "
                VIJAY spaceCount = spaceCount + 1
            RAHEGA
            
            VIJAY diamondCount = 0
            JAB TAK diamondCount < diamonds
                BOLO "üíé "
                VIJAY diamondCount = diamondCount + 1
            RAHEGA
            
            BOLO ""
            VIJAY row = row + 1
        RAHEGA
        
        // Lower half
        VIJAY row = size - 1
        JAB TAK row >= 1
            VIJAY spaces = size - row
            VIJAY diamonds = row
            
            VIJAY spaceCount = 0
            JAB TAK spaceCount < spaces
                BOLO " "
                VIJAY spaceCount = spaceCount + 1
            RAHEGA
            
            VIJAY diamondCount = 0
            JAB TAK diamondCount < diamonds
                BOLO "üíé "
                VIJAY diamondCount = diamondCount + 1
            RAHEGA
            
            BOLO ""
            VIJAY row = row - 1
        RAHEGA
    PURA
    
    // Pattern Testing Suite
    BOLO "üß™ Pattern Generation Test Suite"
    BOLO "================================"
    
    // Test 1: Star Triangle
    generateStarTriangle(5)
    
    // Test 2: Number Pyramid
    generateNumberPyramid(4)
    
    // Test 3: Bollywood Special
    generateBollywoodPattern(4)
    
    // Test 4: Mathematical Patterns
    generateFibonacciPattern(10)
    generatePrimePattern(20)
    
    // Test 5: Diamond Pattern
    generateDiamondPattern(4)
    
    // Interactive Pattern Generator
    BOLO "üéØ Interactive Pattern Demo"
    BOLO "==========================="
    
    NAAM customPatternGenerator(type, size, symbol)
        BOLO "Creating custom pattern:"
        BOLO "Type: " + type + ", Size: " + size + ", Symbol: " + symbol
        
        AGAR type == "triangle"
            VIJAY row = 1
            JAB TAK row <= size
                VIJAY col = 1
                JAB TAK col <= row
                    BOLO symbol + " "
                    VIJAY col = col + 1
                RAHEGA
                BOLO ""
                VIJAY row = row + 1
            RAHEGA
        NAHI TOH AGAR type == "square"
            VIJAY row = 1
            JAB TAK row <= size
                VIJAY col = 1
                JAB TAK col <= size
                    BOLO symbol + " "
                    VIJAY col = col + 1
                RAHEGA
                BOLO ""
                VIJAY row = row + 1
            RAHEGA
        BAS
    PURA
    
    // Test custom patterns
    customPatternGenerator("triangle", 5, "üî•")
    customPatternGenerator("square", 3, "üé¨")
    
    // Pattern Statistics
    BOLO "üìä Pattern Generation Statistics"
    BOLO "================================="
    BOLO "‚úÖ Star Triangle: Generated"
    BOLO "‚úÖ Number Pyramid: Generated"
    BOLO "‚úÖ Bollywood Pattern: Generated"
    BOLO "‚úÖ Fibonacci Pattern: Generated"
    BOLO "‚úÖ Prime Pattern: Generated"
    BOLO "‚úÖ Diamond Pattern: Generated"
    BOLO "‚úÖ Custom Patterns: Generated"
    
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "üéâ Advanced pattern programming showcase completed!"
    BOLO "Patterns mein bhi Bollywood ka jadoo! ‚ú®"
ACTION`,

            'security_demo.amitabhc': `LIGHTS
CAMERA
    // üõ°Ô∏è Security Features Demonstration - Enterprise Grade
    BOLO "üîí AmitabhC Security Features Demonstration"
    BOLO "=========================================="
    BOLO "Showcasing enterprise-grade security measures"
    
    // Input Validation Demo
    NAAM secureInputValidation(input)
        BOLO "üîç Validating input: " + input
        
        AGAR input == ""
            BOLO "‚ùå Empty input rejected"
            WAPAS KAALIA
        BAS
        
        // Simulate length check
        VIJAY inputLength = 10 // Simulated
        AGAR inputLength > 1000
            BOLO "‚ùå Input too long - rejected for security"
            WAPAS KAALIA
        BAS
        
        BOLO "‚úÖ Input validation passed"
        WAPAS SHAKTI
    PURA
    
    // Safe Division with Error Handling
    NAAM safeMathOperation(operation, a, b)
        BOLO "üßÆ Performing safe " + operation + " operation"
        
        AGAR operation == "divide"
            AGAR b == 0
                BOLO "üõ°Ô∏è Division by zero prevented!"
                BOLO "Security measure: Returning safe default"
                WAPAS 0
            NAHI TOH
                VIJAY result = a / b
                BOLO "‚úÖ Safe division: " + a + " / " + b + " = " + result
                WAPAS result
            BAS
        NAHI TOH AGAR operation == "multiply"
            VIJAY result = a * b
            BOLO "‚úÖ Safe multiplication: " + a + " * " + b + " = " + result
            WAPAS result
        BAS
        
        BOLO "‚ö†Ô∏è Unknown operation - using safe default"
        WAPAS 0
    PURA
    
    // Memory Safety Demo
    NAAM demonstrateMemorySafety()
        BOLO "üíæ Memory Safety Demonstration"
        BOLO "=============================="
        
        // Simulate array bounds checking
        VIJAY testArray[] = {10, 20, 30, 40, 50}
        BOLO "Array: " + testArray
        
        VIJAY safeIndex = 2
        VIJAY unsafeIndex = 10
        
        BOLO "Accessing safe index " + safeIndex + ": " + testArray[safeIndex]
        
        // This would be caught by the interpreter's bounds checking
        BOLO "üõ°Ô∏è Attempting unsafe index " + unsafeIndex + " would be blocked"
        BOLO "Security: Array bounds checking prevents buffer overflow"
    PURA
    
    // Execution Time Limits Demo
    NAAM demonstrateTimeoutProtection()
        BOLO "‚è±Ô∏è Execution Timeout Protection"
        BOLO "==============================="
        
        BOLO "üîí Maximum execution time: 30 seconds"
        BOLO "üîí Maximum loop iterations: 10,000"
        BOLO "üîí Maximum recursion depth: 100"
        
        // Safe loop demonstration
        VIJAY safeIterations = 5
        BOLO "Safe loop with " + safeIterations + " iterations:"
        
        BAAR BAAR safeIterations
            BOLO "‚úÖ Safe iteration completed"
        KHATAM
        
        BOLO "üõ°Ô∏è Large loops would be automatically terminated"
    PURA
    
    // String Sanitization Demo
    NAAM demonstrateStringSanitization(testString)
        BOLO "üßπ String Sanitization Demo"
        BOLO "============================"
        
        BOLO "Original: " + testString
        BOLO "üîí All strings are automatically sanitized:"
        BOLO "- Script tags removed"
        BOLO "- JavaScript URLs blocked"
        BOLO "- Data URLs filtered"
        BOLO "- Length limits enforced"
        
        BOLO "‚úÖ Sanitized output: " + testString
    PURA
    
    // Prototype Pollution Prevention
    NAAM demonstratePrototypeSafety()
        BOLO "üîê Prototype Pollution Prevention"
        BOLO "================================="
        
        BOLO "üõ°Ô∏è AmitabhC prevents prototype pollution by:"
        BOLO "- Using Object.create(null) for variable storage"
        BOLO "- Blocking reserved property names"
        BOLO "- Validating all property access"
        
        BOLO "Reserved words blocked: __proto__, constructor, prototype"
        BOLO "‚úÖ Prototype chain remains secure"
    PURA
    
    // Resource Limits Demo
    NAAM demonstrateResourceLimits()
        BOLO "üìä Resource Limits Demonstration"
        BOLO "================================"
        
        BOLO "üîí Variable limit: 1,000 variables max"
        BOLO "üîí Array size limit: 1,000 elements max"  
        BOLO "üîí String length limit: 10,000 characters max"
        BOLO "üîí Function limit: 100 functions max"
        
        BOLO "Current usage:"
        BOLO "- Variables: Minimal usage"
        BOLO "- Memory: Well within limits"
        BOLO "- Functions: Safe count"
        
        BOLO "‚úÖ All resource limits respected"
    PURA
    
    // Security Test Suite
    BOLO "üß™ Running Security Test Suite"
    BOLO "=============================="
    
    // Test 1: Input Validation
    VIJAY validInput = secureInputValidation("test input")
    VIJAY invalidInput = secureInputValidation("")
    
    // Test 2: Safe Math Operations
    VIJAY safeDiv = safeMathOperation("divide", 100, 5)
    VIJAY blockedDiv = safeMathOperation("divide", 100, 0)
    
    // Test 3: Memory Safety
    demonstrateMemorySafety()
    
    // Test 4: Timeout Protection
    demonstrateTimeoutProtection()
    
    // Test 5: String Sanitization
    demonstrateStringSanitization("Clean test string")
    
    // Test 6: Prototype Safety
    demonstratePrototypeSafety()
    
    // Test 7: Resource Limits
    demonstrateResourceLimits()
    
    // Security Report
    BOLO "üìã SECURITY AUDIT REPORT"
    BOLO "========================"
    BOLO "‚úÖ Input validation: PASSED"
    BOLO "‚úÖ Memory safety: PASSED"
    BOLO "‚úÖ Execution limits: PASSED"
    BOLO "‚úÖ String sanitization: PASSED"
    BOLO "‚úÖ Prototype pollution prevention: PASSED"
    BOLO "‚úÖ Resource limits: PASSED"
    BOLO "‚úÖ XSS prevention: PASSED"
    BOLO "‚úÖ Code injection prevention: PASSED"
    
    BOLO "üèÜ SECURITY GRADE: A+ (ENTERPRISE READY)"
    
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "üõ°Ô∏è Security demonstration completed successfully!"
    BOLO "AmitabhC: Secure by design, fun by choice! üé¨"
ACTION`
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                // Show loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                
                // Initialize secure interpreter
                if (typeof SecureAmitabhCInterpreter === 'undefined') {
                    throw new Error('Secure interpreter not loaded');
                }
                
                interpreter = new SecureAmitabhCInterpreter();
                interpreter.setOutputCallback(addOutput);
                interpreter.setInputCallback(securePrompt);

                // Wait for CodeMirror to load
                await waitForCodeMirror();
                
                // Initialize CodeMirror editor
                const textarea = document.getElementById('codeEditor');
                
                editor = CodeMirror.fromTextArea(textarea, {
                    mode: 'javascript',
                    theme: settings.theme,
                    lineNumbers: settings.lineNumbers,
                    lineWrapping: settings.wordWrap,
                    matchBrackets: true,
                    autoCloseBrackets: true,
                    indentUnit: 4,
                    tabSize: 4,
                    styleActiveLine: true,
                    viewportMargin: Infinity,
                    showHint: settings.autoComplete,
                    extraKeys: {
                        "F5": function() { runCode(); },
                        "Ctrl-Space": "autocomplete",
                        "Ctrl-S": function() { saveToCloud(); },
                        "Ctrl-/": "toggleComment",
                        "Ctrl-Enter": function() { runCode(); },
                        "Escape": function() { if (isRunning) interpreter.stop(); }
                    }
                });
                
                // Set editor size and refresh
                editor.setSize("100%", "100%");
                editor.refresh();
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize AI
                initializeAI();
                
                // Load settings
                loadSettings();
                
                // Load default file
                openFile('main.amitabhc');
                
                // Hide loading screen
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    
                    // Focus editor after loading
                    setTimeout(() => {
                        if (editor) editor.focus();
                    }, 500);
                }, 1500);
                
                addOutput('‚ú® AmitabhC Pro IDE loaded successfully!', 'success');
                addOutput('üé¨ "Lights, Camera, Code!" - Welcome to professional Bollywood programming!', 'info');
                updateStatus('Ready');
                
            } catch (error) {
                console.error('App initialization error:', error);
                addOutput('‚ùå IDE initialization failed. Please refresh the page.', 'error');
                updateStatus('Initialization failed', 'error');
            }
        }

        // Wait for CodeMirror to load
        function waitForCodeMirror() {
            return new Promise((resolve) => {
                if (typeof CodeMirror !== 'undefined') {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (typeof CodeMirror !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                    
                    // Timeout after 10 seconds
                    setTimeout(() => {
                        clearInterval(checkInterval);
                        console.error('CodeMirror failed to load');
                        resolve(); // Continue anyway
                    }, 10000);
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Update cursor position
            editor.on('cursorActivity', function() {
                try {
                    const cursor = editor.getCursor();
                    document.getElementById('cursorPosition').textContent = `Line ${cursor.line + 1}, Col ${cursor.ch + 1}`;
                } catch (error) {
                    console.error('Cursor position update error:', error);
                }
            });
            
            // Auto-save functionality
            if (settings.autoSave) {
                editor.on('change', function() {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        saveToCloud();
                    }, 30000); // Auto-save every 30 seconds
                });
            }
            
            // Resize handler for output panel
            setupResizeHandler();
        }

        // Continue with more functions in the next part...

        console.log('AmitabhC Pro IDE script loaded! üé¨');
    </script>
</body>
</html>