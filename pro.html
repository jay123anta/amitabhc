<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AmitabhC Pro - Professional Bollywood IDE</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' cdnjs.cloudflare.com; 
                   style-src 'self' 'unsafe-inline' cdnjs.cloudflare.com; 
                   img-src 'self' data:;
                   connect-src 'self';
                   frame-ancestors 'none';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#ff9933">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé¨</text></svg>">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- CodeMirror CDN with fallback -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" 
          onerror="this.onerror=null; this.href='css/vendor/codemirror.css';">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css"
          onerror="this.onerror=null; this.href='css/vendor/dracula.css';">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css"
          onerror="this.onerror=null; this.href='css/vendor/show-hint.css';">
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="app">
        <!-- Header -->
        <header class="header" role="banner" aria-label="AmitabhC Pro IDE Header">
            <div class="logo">
                AmitabhC Pro
                <span style="font-size: 0.7em; opacity: 0.8;">Professional IDE</span>
            </div>
            
            <nav class="controls" role="navigation" aria-label="Main IDE controls">
                <button class="mobile-toggle" 
                        onclick="toggleMobileSidebar()" 
                        aria-label="Toggle file explorer"
                        aria-expanded="false">
                    üìÅ
                </button>
                
                <button class="btn-primary" 
                        onclick="runCode()" 
                        aria-label="Run AmitabhC code"
                        aria-describedby="run-help"
                        aria-keyshortcuts="F5"
                        id="runButton">
                    ‚ñ∂Ô∏è Run
                </button>
                <div id="run-help" class="sr-only">Press F5 to run your AmitabhC program</div>
                
                <button class="btn-secondary" 
                        onclick="toggleAI()" 
                        aria-label="Toggle AI Assistant"
                        aria-expanded="false"
                        aria-controls="aiChat"
                        id="aiToggle">
                    ü§ñ AI
                </button>
                
                <button class="btn-secondary" 
                        onclick="exportCode()" 
                        aria-label="Export code to file">
                    üì• Export
                </button>
                
                <button class="btn-secondary" 
                        onclick="saveToCloud()" 
                        aria-label="Save to local storage">
                    ‚òÅÔ∏è Save
                </button>
            </nav>
            
            <div style="margin-left: auto; display: flex; align-items: center; gap: 16px;">
                <div role="status" aria-live="polite">
                    <span class="loading" id="loadingSpinner" style="display: none;" aria-hidden="true"></span>
                    <span id="statusText">Ready</span>
                </div>
                <span style="font-size: 11px; color: #30363d;">v2.0</span>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="content" role="main">
            <!-- Sidebar -->
            <aside class="sidebar" role="complementary" aria-label="File Explorer and Tools">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">
                        üìÅ Project Explorer
                    </h2>
                </div>
                
                <nav class="file-explorer" role="navigation" aria-label="Project files">
                    <button class="file-item active" 
                            onclick="openFile('main.amitabhc')" 
                            aria-current="page"
                            data-file="main">
                        üé¨ main.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('examples.amitabhc')" 
                            data-file="examples">
                        üìö examples.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('functions.amitabhc')" 
                            data-file="functions">
                        ‚ö° functions.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('calculator.amitabhc')" 
                            data-file="calculator">
                        üßÆ calculator.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('kbc_game.amitabhc')" 
                            data-file="kbc">
                        üéØ kbc_game.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('kbc_advanced.amitabhc')" 
                            data-file="kbc_advanced">
                        üèÜ kbc_advanced.amitabhc
                    </button>
                    <button class="file-item" 
                            onclick="openFile('patterns.amitabhc')" 
                            data-file="patterns">
                        üåü patterns.amitabhc
                    </button>
                </nav>
                
                <div class="ai-panel">
                    <button class="ai-assistant" 
                            onclick="toggleAI()"
                            aria-label="Open AI Assistant for coding help">
                        <div style="font-weight: 600; margin-bottom: 4px;">ü§ñ AI Assistant</div>
                        <div style="font-size: 11px; opacity: 0.9;">Get coding help instantly</div>
                    </button>
                </div>
            </aside>

            <!-- Workspace -->
            <section class="workspace" aria-label="Code Editor Workspace">
                <!-- Tabs -->
                <nav role="tablist" aria-label="Open files" class="tabs">
                    <button role="tab" 
                            class="tab active" 
                            aria-selected="true"
                            aria-controls="editor-panel"
                            id="currentTab">
                        üé¨ <span id="tabName">main.amitabhc</span>
                        <button class="tab-close" 
                                onclick="closeTab()"
                                aria-label="Close current file"
                                tabindex="-1">√ó</button>
                    </button>
                </nav>

                <!-- Editor -->
                <div role="tabpanel" 
                     id="editor-panel"
                     aria-labelledby="currentTab"
                     class="editor-section">
                    <label for="codeEditor" class="sr-only">
                        AmitabhC code editor. Use Tab to indent, Shift+Tab to unindent. Press F5 to run code.
                    </label>
                    <textarea id="codeEditor" aria-describedby="editor-help">LIGHTS
CAMERA
    // üé¨ Welcome to AmitabhC Pro - Professional Bollywood IDE!
    DEVIYON_AUR_SAJJANO
    BOLO "Namaste! Welcome to AmitabhC Pro!"
    BOLO "Rishtey mein toh hum tumhare advanced compiler lagte hain!"
    
    // üé≠ Variable declarations with style
    VIJAY name = "Amitabh Bachchan"
    VIJAY age = 80
    DON films_count = 200
    
    BOLO "Superstar Details:"
    BOLO "Name: " + name
    BOLO "Age: " + age + " years"
    BOLO "Films: " + films_count + " movies"
    
    // üéØ Conditional logic
    AGAR age > 75
        BOLO "Main hoon ek living legend!"
        BOLO "Experience ka koi shortcut nahi hota beta!"
    NAHI TOH
        BOLO "Abhi toh main jawaan hoon!"
    BAS
    
    // üîÑ Loop demonstration
    BOLO "Famous Dialogues:"
    BAAR BAAR 3
        BOLO "- Don ko pakadna mushkil hi nahi, namumkin hai!"
    KHATAM
    
    // ‚ö° Function example
    NAAM greetAudience(message)
        BOLO "üé¨ " + message
        WAPAS SHAKTI
    PURA
    
    greetAudience("Keh diya, bas keh diya!")
    
    // üìä Array demonstration
    VIJAY iconic_movies[] = {"Sholay", "Deewar", "Don", "Agneepath", "Coolie"}
    BOLO "Iconic Movies: " + iconic_movies
    
    // üéØ KBC Style Interactive
    BOLO "=== KBC Style Programming Quiz ==="
    COMPUTER_JI_LOCK_KIYA_JAYE
    BOLO "Successfully locked in the answer!"
    
    BOLO "‚ú® AmitabhC Pro Features Unlocked!"
    BOLO "- AI-Powered Code Assistance"
    BOLO "- Advanced Debugging Tools"
    BOLO "- Cloud Synchronization"
    BOLO "- Multi-format Export"
    BOLO "- Voice Coding Support"
    
ACTION</textarea>
                    <div id="editor-help" class="sr-only">
                        AmitabhC Pro editor with syntax highlighting and autocomplete. 
                        Use Ctrl+Space for suggestions, F5 to run code.
                    </div>
                </div>

                <!-- Output Section -->
                <section class="output-section" 
                         role="log" 
                         aria-label="Program Output">
                    <div class="resize-handle" 
                         id="resizeHandle"
                         aria-label="Resize output panel"
                         role="separator"></div>
                    
                    <div class="output-header">
                        <h3 class="output-title">
                            üì∫ Output Console
                        </h3>
                        <div class="output-controls" role="group" aria-label="Output controls">
                            <button class="btn-secondary" 
                                    onclick="clearOutput()" 
                                    aria-label="Clear console output">
                                üóëÔ∏è
                            </button>
                            <button class="btn-secondary" 
                                    onclick="toggleFullscreen()" 
                                    aria-label="Toggle fullscreen output">
                                ‚õ∂
                            </button>
                        </div>
                    </div>
                    
                    <div class="output-body" 
                         id="outputBody"
                         role="log"
                         aria-live="polite"
                         aria-label="Program execution output">
                        <div class="output-line info">
                            ‚ú® AmitabhC Pro IDE is ready!
                        </div>
                        <div class="output-line info">
                            üé¨ "Jahan code shuru hota hai, wahin se programming ki line shuru hoti hai!"
                        </div>
                    </div>
                </section>
            </section>
        </main>

        <!-- Status Bar -->
        <footer class="status" role="contentinfo" aria-label="IDE Status">
            <div class="status-item ready">
                <span aria-hidden="true">‚óè</span>
                <span id="mainStatus">Ready</span>
            </div>
            <div class="status-item">
                <span id="cursorPosition">Line 1, Col 1</span>
            </div>
            <div class="status-item">
                <span id="fileEncoding">UTF-8</span>
            </div>
            <div class="status-item">
                <span>AmitabhC</span>
            </div>
            <div style="margin-left: auto;">
                <span>Pro IDE v2.0</span>
            </div>
        </footer>
    </div>

    <!-- AI Chat Dialog -->
    <dialog class="ai-chat" 
            id="aiChat"
            aria-labelledby="ai-chat-title"
            aria-describedby="ai-chat-desc">
        <div class="ai-chat-header">
            <h2 id="ai-chat-title" class="ai-chat-title">
                ü§ñ AmitabhC AI Assistant
            </h2>
            <button class="ai-chat-close" 
                    onclick="toggleAI()"
                    aria-label="Close AI Assistant">√ó</button>
        </div>
        
        <div id="ai-chat-desc" class="sr-only">
            AI assistant to help with AmitabhC programming questions and debugging
        </div>
        
        <div class="ai-messages" 
             id="aiMessages"
             role="log"
             aria-live="polite"
             aria-label="AI conversation history">
            <!-- Messages will be added here -->
        </div>
        
        <form onsubmit="sendAIMessage(); return false;" class="ai-input-area">
            <label for="aiInput" class="sr-only">Ask AI Assistant about AmitabhC programming</label>
            <input type="text" 
                   class="ai-input" 
                   id="aiInput"
                   placeholder="Ask me anything about AmitabhC..."
                   aria-describedby="ai-input-help"
                   maxlength="1000">
            <button type="submit" 
                    class="ai-send" 
                    aria-label="Send message to AI assistant">Send</button>
            <div id="ai-input-help" class="sr-only">
                Type your question about AmitabhC programming and press Enter or click Send
            </div>
        </form>
    </dialog>

    <!-- Load secure interpreter -->
    <script src="interpreter.js"></script>
    
    <!-- Load CodeMirror with fallback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"
            onerror="loadFallbackScript('js/vendor/codemirror.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"
            onerror="loadFallbackScript('js/vendor/javascript.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"
            onerror="loadFallbackScript('js/vendor/show-hint.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"
            onerror="loadFallbackScript('js/vendor/matchbrackets.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"
            onerror="loadFallbackScript('js/vendor/closebrackets.min.js')"></script>

    <script>
        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            addOutput('‚ö†Ô∏è An unexpected error occurred. Please check the console.', 'error');
        });

        // Promise rejection handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
        });

        // Fallback script loader
        function loadFallbackScript(src) {
            console.log('Loading fallback script:', src);
            const script = document.createElement('script');
            script.src = src;
            script.async = false;
            document.head.appendChild(script);
        }

        // Global Variables
        let editor;
        let interpreter;
        let currentFile = 'main.amitabhc';
        let isResizing = false;
        let startY, startHeight;
        
        // Enhanced file contents with more examples
        const fileContents = {
            'main.amitabhc': document.getElementById('codeEditor').value,
            'examples.amitabhc': `LIGHTS
CAMERA
    BOLO "üé¨ AmitabhC Examples Showcase!"
    BOLO "================================="
    
    // üìä Mathematics and Variables
    VIJAY num1 = 100
    VIJAY num2 = 42
    VIJAY result = num1 + num2
    BOLO "Mathematical Operation:"
    BOLO num1 + " + " + num2 + " = " + result
    
    // üéØ Conditional Logic
    VIJAY temperature = 35
    BOLO "Weather Check:"
    AGAR temperature > 30
        BOLO "üå°Ô∏è It's hot! Temperature: " + temperature + "¬∞C"
        BOLO "Garmi mein bhi hum cool rahe hain!"
    NAHI TOH AGAR temperature < 20
        BOLO "üå®Ô∏è It's cold! Bundle up!"
    NAHI TOH
        BOLO "üå§Ô∏è Perfect weather!"
    BAS
    
    // üîÑ Loop Demonstrations
    BOLO "Counting with BAAR BAAR:"
    BAAR BAAR 5
        BOLO "‚≠ê Superstar moment!"
    KHATAM
    
    BOLO "While loop with JAB TAK:"
    VIJAY countdown = 5
    JAB TAK countdown > 0
        BOLO "üöÄ Launch in " + countdown + " seconds"
        VIJAY countdown = countdown - 1
    RAHEGA
    BOLO "üé¨ Action!"
    
    // üìö Array Operations
    VIJAY movies[] = {"Sholay", "Deewar", "Don", "Agneepath"}
    BOLO "Iconic Movies Array:"
    BOLO "Total movies: " + movies
    BOLO "First movie: " + movies[0]
    BOLO "Last movie: " + movies[3]
    
    BOLO "‚ú® Examples completed successfully!"
ACTION`,
            
            'functions.amitabhc': `LIGHTS
CAMERA
    BOLO "‚ö° AmitabhC Functions Masterclass!"
    BOLO "====================================="
    
    // üé≠ Simple Function
    NAAM greetBollywood()
        BOLO "üé¨ Welcome to Bollywood Programming!"
        BOLO "Lights, Camera, Code!"
    PURA
    
    // üßÆ Function with Parameters
    NAAM calculate(operation, a, b)
        AGAR operation == "add"
            VIJAY result = a + b
            BOLO a + " + " + b + " = " + result
        NAHI TOH AGAR operation == "multiply"
            VIJAY result = a * b
            BOLO a + " √ó " + b + " = " + result
        NAHI TOH
            BOLO "Unknown operation: " + operation
        BAS
    PURA
    
    // üéØ Function with Return Value
    NAAM getSuperheroName(realName)
        AGAR realName == "Amitabh"
            WAPAS "Shahenshah"
        NAHI TOH AGAR realName == "Vijay"
            WAPAS "Don"
        NAHI TOH
            WAPAS "Hero"
        BAS
    PURA
    
    // üî¢ Recursive Function
    NAAM factorial(n)
        AGAR n <= 1
            WAPAS 1
        NAHI TOH
            WAPAS n * factorial(n - 1)
        BAS
    PURA
    
    // üé™ Function Calls
    BOLO "=== Function Demonstrations ==="
    greetBollywood()
    
    BOLO "=== Calculator Functions ==="
    calculate("add", 25, 17)
    calculate("multiply", 8, 9)
    
    BOLO "=== Superhero Name Generator ==="
    VIJAY hero1 = getSuperheroName("Amitabh")
    VIJAY hero2 = getSuperheroName("Vijay")
    BOLO "Amitabh is known as: " + hero1
    BOLO "Vijay is known as: " + hero2
    
    BOLO "=== Factorial Calculator ==="
    VIJAY fact5 = factorial(5)
    VIJAY fact7 = factorial(7)
    BOLO "Factorial of 5: " + fact5
    BOLO "Factorial of 7: " + fact7
    
    BOLO "üéâ Function masterclass completed!"
ACTION`,
            
            'calculator.amitabhc': `LIGHTS
CAMERA
    BOLO "üßÆ AmitabhC Advanced Calculator"
    BOLO "================================"
    
    // üìä Calculator Functions
    NAAM add(x, y)
        WAPAS x + y
    PURA
    
    NAAM subtract(x, y)
        WAPAS x - y
    PURA
    
    NAAM multiply(x, y)
        WAPAS x * y
    PURA
    
    NAAM divide(x, y)
        AGAR y == 0
            BOLO "‚ùå Error: Division by zero!"
            WAPAS 0
        NAHI TOH
            WAPAS x / y
        BAS
    PURA
    
    NAAM power(base, exponent)
        VIJAY result = 1
        BAAR BAAR exponent
            VIJAY result = result * base
        KHATAM
        WAPAS result
    PURA
    
    // üéØ Calculator Demo
    VIJAY num1 = 144
    VIJAY num2 = 12
    
    BOLO "Calculator Input:"
    BOLO "Number 1: " + num1
    BOLO "Number 2: " + num2
    BOLO "------------------------"
    
    VIJAY sum = add(num1, num2)
    VIJAY difference = subtract(num1, num2)
    VIJAY product = multiply(num1, num2)
    VIJAY quotient = divide(num1, num2)
    VIJAY power_result = power(num2, 2)
    
    BOLO "‚ûï Addition: " + num1 + " + " + num2 + " = " + sum
    BOLO "‚ûñ Subtraction: " + num1 + " - " + num2 + " = " + difference
    BOLO "‚úñÔ∏è Multiplication: " + num1 + " √ó " + num2 + " = " + product
    BOLO "‚ûó Division: " + num1 + " √∑ " + num2 + " = " + quotient
    BOLO "üî¢ Power: " + num2 + "¬≤ = " + power_result
    
    // üìà Advanced Calculations
    BOLO "=== Advanced Calculations ==="
    VIJAY percentage = (num2 / num1) * 100
    BOLO "üìä " + num2 + " is " + percentage + "% of " + num1
    
    VIJAY average = (num1 + num2) / 2
    BOLO "üìä Average: " + average
    
    BOLO "‚úÖ Calculator operations completed!"
    BOLO "Hisaab kitaab ho gaya!"
ACTION`,
            
            'kbc_game.amitabhc': `LIGHTS
CAMERA
    // üéØ Kaun Banega Crorepati - AmitabhC Edition
    BOLO "üèÜ KAUN BANEGA CROREPATI - CODING EDITION üèÜ"
    BOLO "=============================================="
    DEVIYON_AUR_SAJJANO
    BOLO "Main hoon aapka host, Amitabh Bachchan!"
    BOLO "Aaj hum khelenge programming ka sabse bada quiz!"
    
    // üéÆ Game State
    VIJAY total_winnings = 0
    VIJAY current_question = 1
    VIJAY lifeline_5050 = SHAKTI
    VIJAY lifeline_audience = SHAKTI
    VIJAY lifeline_phone = SHAKTI
    
    // üí∞ Prize Money Ladder
    VIJAY prize_ladder[] = {1000, 5000, 10000, 50000, 100000, 500000, 1000000}
    
    BOLO "üéØ Question " + current_question + " for Rs. " + prize_ladder[0] + ":"
    BOLO "AmitabhC mein variable declare karne ke liye kya use hote hai?"
    BOLO "A) VAR    B) LET    C) VIJAY    D) VARIABLE"
    
    // üÜò Lifeline Options
    BOLO "üÜò Available Lifelines:"
    AGAR lifeline_5050 == SHAKTI
        BOLO "1Ô∏è‚É£ Fifty-Fifty"
    BAS
    AGAR lifeline_audience == SHAKTI
        BOLO "2Ô∏è‚É£ Audience Poll"
    BAS
    AGAR lifeline_phone == SHAKTI
        BOLO "3Ô∏è‚É£ Phone a Friend"
    BAS
    
    // üéØ Simulate lifeline usage
    BOLO "üé™ Using Audience Poll lifeline..."
    AUDIENCE_POLL
    BOLO "üìä 83% audience voted for option C!"
    VIJAY lifeline_audience = KAALIA
    
    // üí° Expert advice
    BOLO "üéì Let's also get expert advice..."
    EXPERT_ADVICE
    
    // üîí Lock the answer
    BOLO "üéØ Final Answer: C) VIJAY"
    CONFIDENT_TO_LOCK_KIYA_JAYE
    
    // ‚úÖ Correct Answer
    BOLO "üéâ BILKUL SAHI JAWAB!"
    COMPUTER_JI_LOCK_KIYA_JAYE
    VIJAY total_winnings = prize_ladder[0]
    BOLO "üèÜ Congratulations! You've won Rs. " + total_winnings + "!"
    
    // üèÅ Game Summary
    BOLO "üèÜ GAME SUMMARY"
    BOLO "==============="
    BOLO "Questions Answered: " + current_question
    BOLO "Total Winnings: Rs. " + total_winnings
    
    AGAR total_winnings >= 1000
        BOLO "üåü EXCELLENT PERFORMANCE!"
        BOLO "Aap ek true AmitabhC programmer hain!"
    BAS
    
    BOLO "üé¨ Thank you for playing KBC - Coding Edition!"
    BOLO "Milte hain phir, nayi programming adventures ke saath!"
    BOLO "Dhanyawad!"
ACTION`,
            
            'kbc_advanced.amitabhc': `LIGHTS
CAMERA
    // üèÜ KBC Advanced - The Ultimate Programming Challenge
    BOLO "üé™ KAUN BANEGA CROREPATI - ADVANCED EDITION üé™"
    BOLO "==============================================="
    DEVIYON_AUR_SAJJANO
    BOLO "Welcome to the most challenging programming quiz!"
    BOLO "Aaj ka sawaal hai - Can you become a Crorepati coder?"
    
    // üéÆ Advanced Game State
    VIJAY player_score = 0
    VIJAY question_level = 1
    VIJAY difficulty_multiplier = 1
    VIJAY bonus_points = 0
    
    // üèÜ Advanced Prize Structure
    VIJAY mega_prizes[] = {1000, 5000, 10000, 50000, 100000, 500000, 1000000, 5000000}
    
    // üÜò Enhanced Lifelines
    VIJAY lifeline_5050 = SHAKTI
    VIJAY lifeline_audience = SHAKTI
    VIJAY lifeline_phone = SHAKTI
    VIJAY lifeline_expert = SHAKTI
    
    // üéØ Question Bank Function
    NAAM askAdvancedQuestion(level)
        AGAR level == 1
            BOLO "üî• Advanced Question " + level + " for Rs. " + mega_prizes[level-1] + ":"
            BOLO "What does 'JAB TAK' create in AmitabhC?"
            BOLO "A) For Loop    B) While Loop    C) If Condition    D) Function"
            WAPAS "B"
        NAHI TOH AGAR level == 2
            BOLO "üî• Advanced Question " + level + " for Rs. " + mega_prizes[level-1] + ":"
            BOLO "Which command is used for function return?"
            BOLO "A) RETURN    B) WAPAS    C) BACK    D) END"
            WAPAS "B"
        NAHI TOH AGAR level == 3
            BOLO "üî• Expert Question " + level + " for Rs. " + mega_prizes[level-1] + ":"
            BOLO "What represents 'true' in AmitabhC?"
            BOLO "A) TRUE    B) SHAKTI    C) YES    D) ON"
            WAPAS "B"
        NAHI TOH
            BOLO "üèÜ JACKPOT Question for Rs. " + mega_prizes[level-1] + ":"
            BOLO "What does 'DEVIYON_AUR_SAJJANO' do?"
            BOLO "A) Print    B) Input    C) Greeting    D) Exit"
            WAPAS "C"
        BAS
    PURA
    
    // üéÆ Main Game Loop
    BOLO "üé™ Let the advanced challenge begin!"
    
    // üéØ Question 1
    VIJAY correct_answer = askAdvancedQuestion(1)
    AUDIENCE_POLL
    
    BOLO "ü§î Thinking time... What's your final answer?"
    CONFIDENT_TO_LOCK_KIYA_JAYE
    
    BOLO "‚úÖ Correct! SHABASH!"
    COMPUTER_JI_LOCK_KIYA_JAYE
    VIJAY player_score = mega_prizes[0]
    VIJAY bonus_points = bonus_points + 100
    
    // üéØ Question 2
    VIJAY question_level = 2
    VIJAY correct_answer = askAdvancedQuestion(2)
    PHONE_A_FRIEND "AmitabhC Master Programmer"
    
    BOLO "üéØ This is getting serious! Lock your answer?"
    CONFIDENT_TO_LOCK_KIYA_JAYE
    
    BOLO "üéâ FANTASTIC! You're on fire!"
    COMPUTER_JI_LOCK_KIYA_JAYE
    VIJAY player_score = mega_prizes[1]
    VIJAY bonus_points = bonus_points + 250
    
    // üèÅ Grand Finale
    BOLO "üèÜ GRAND FINALE RESULTS üèÜ"
    BOLO "=========================="
    BOLO "Final Score: Rs. " + player_score
    BOLO "Bonus Points: " + bonus_points
    VIJAY total_achievement = player_score + bonus_points
    BOLO "Total Achievement: Rs. " + total_achievement
    
    BOLO "üé™ Performance Analysis:"
    AGAR player_score >= 5000
        BOLO "üåü OUTSTANDING! AmitabhC EXPERT level achieved!"
        BOLO "You deserve the title: 'Shahenshah of Coding'!"
    NAHI TOH AGAR player_score >= 1000
        BOLO "üéØ EXCELLENT! Advanced programmer status!"
        BOLO "Title earned: 'Don of AmitabhC'!"
    NAHI TOH
        BOLO "üëç GOOD EFFORT! Keep practicing!"
        BOLO "Title: 'Rising Star Programmer'!"
    BAS
    
    // üé¨ Epic Conclusion
    BOLO "üé¨ Yeh kahani khatam nahi hui..."
    BOLO "AmitabhC programming adventure continues!"
    BOLO "Keep coding, keep learning, keep growing!"
    BOLO "'Jab tak programming hai, tab tak AmitabhC hai!'"
    BOLO "Thank you for playing KBC Advanced Edition!"
    
    // üéä Victory Dance
    BAAR BAAR 3
        BOLO "üéâ CELEBRATION TIME! üéâ"
    KHATAM
    
ACTION`,
            
            'patterns.amitabhc': `LIGHTS
CAMERA
    BOLO "üåü AmitabhC Pattern Programming Showcase!"
    BOLO "========================================"
    
    // üî∑ Pattern 1: Simple Square
    BOLO "üìê Pattern 1: Square Matrix"
    BOLO "- - - - - - - - - -"
    BAAR BAAR 5
        BAAR BAAR 5
            BOLO "‚≠ê "
        KHATAM
        BOLO ""
    KHATAM
    
    // üî∫ Pattern 2: Right Triangle
    BOLO "üìê Pattern 2: Right Triangle"
    BOLO "- - - - - - - - - -"
    VIJAY row = 1
    JAB TAK row <= 6
        VIJAY col = 1
        JAB TAK col <= row
            BOLO "üî∏ "
            VIJAY col = col + 1
        RAHEGA
        BOLO ""
        VIJAY row = row + 1
    RAHEGA
    
    // üî¢ Pattern 3: Number Pyramid
    BOLO "üìê Pattern 3: Number Pyramid"
    BOLO "- - - - - - - - - -"
    VIJAY level = 1
    JAB TAK level <= 5
        VIJAY num = 1
        JAB TAK num <= level
            BOLO num + " "
            VIJAY num = num + 1
        RAHEGA
        BOLO ""
        VIJAY level = level + 1
    RAHEGA
    
    // üé≠ Pattern 4: Bollywood Style
    BOLO "üé¨ Pattern 4: Bollywood Special"
    BOLO "- - - - - - - - - -"
    VIJAY bollywood_row = 1
    JAB TAK bollywood_row <= 4
        AGAR bollywood_row == 1
            BOLO "    üé¨ AMITABH üé¨"
        NAHI TOH AGAR bollywood_row == 2
            BOLO "  üåü BACHCHAN üåü"
        NAHI TOH AGAR bollywood_row == 3
            BOLO "üé≠ SUPERSTAR üé≠"
        NAHI TOH
            BOLO "üèÜ LEGEND üèÜ"
        BAS
        BOLO ""
        VIJAY bollywood_row = bollywood_row + 1
    RAHEGA
    
    // üéØ Interactive Pattern Generator
    BOLO "üéØ Interactive Pattern Generator"
    BOLO "================================"
    
    NAAM generateCustomPattern(size, symbol)
        BOLO "Custom Pattern (Size: " + size + ", Symbol: " + symbol + "):"
        VIJAY pattern_row = 1
        JAB TAK pattern_row <= size
            VIJAY pattern_col = 1
            JAB TAK pattern_col <= pattern_row
                BOLO symbol + " "
                VIJAY pattern_col = pattern_col + 1
            RAHEGA
            BOLO ""
            VIJAY pattern_row = pattern_row + 1
        RAHEGA
    PURA
    
    // Test custom pattern generator
    generateCustomPattern(6, "üî•")
    
    BOLO "‚ú® Pattern showcase completed!"
    BOLO "üé¨ Patterns mein bhi Bollywood ka jadoo!"
    BOLO "Keep creating beautiful patterns with AmitabhC!"
ACTION`
        };

        // Initialize CodeMirror Editor
        window.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                // Initialize secure interpreter
                if (typeof SecureAmitabhCInterpreter === 'undefined') {
                    throw new Error('Secure interpreter not loaded');
                }
                
                interpreter = new SecureAmitabhCInterpreter();
                interpreter.setOutputCallback(addOutput);
                interpreter.setInputCallback(securePrompt);

                // Wait for CodeMirror to load
                await waitForCodeMirror();
                
                // Initialize CodeMirror editor
                const textarea = document.getElementById('codeEditor');
                
                editor = CodeMirror.fromTextArea(textarea, {
                    mode: 'javascript',
                    theme: 'dracula',
                    lineNumbers: true,
                    lineWrapping: true,
                    matchBrackets: true,
                    autoCloseBrackets: true,
                    indentUnit: 4,
                    tabSize: 4,
                    styleActiveLine: true,
                    viewportMargin: Infinity,
                    extraKeys: {
                        "F5": function() { runCode(); },
                        "Ctrl-Space": "autocomplete",
                        "Ctrl-S": function() { saveToCloud(); },
                        "Ctrl-/": "toggleComment",
                        "Ctrl-Enter": function() { runCode(); }
                    }
                });
                
                // Set editor size
                editor.setSize("100%", "400px");
                
                // Update cursor position
                editor.on('cursorActivity', function() {
                    try {
                        const cursor = editor.getCursor();
                        document.getElementById('cursorPosition').textContent = `Line ${cursor.line + 1}, Col ${cursor.ch + 1}`;
                    } catch (error) {
                        console.error('Cursor position update error:', error);
                    }
                });
                
                // Auto-refresh editor
                setTimeout(() => {
                    editor.refresh();
                    forceEditorResize();
                }, 100);
                
                // Setup resize functionality
                setupResize();
                
                // Initialize AI
                initializeAI();
                
                // Load default file
                openFile('main.amitabhc');
                
                addOutput('‚ú® AmitabhC Pro IDE loaded successfully!', 'success');
                addOutput('üé¨ "Lights, Camera, Code!" - Welcome to professional Bollywood programming!', 'info');
                
            } catch (error) {
                console.error('App initialization error:', error);
                addOutput('‚ùå IDE initialization failed. Please refresh the page.', 'error');
            }
        }

        // Wait for CodeMirror to load
        function waitForCodeMirror() {
            return new Promise((resolve) => {
                if (typeof CodeMirror !== 'undefined') {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (typeof CodeMirror !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                    
                    // Timeout after 10 seconds
                    setTimeout(() => {
                        clearInterval(checkInterval);
                        console.error('CodeMirror failed to load');
                        resolve(); // Continue anyway
                    }, 10000);
                }
            });
        }

        // Enhanced secure prompt function
        async function securePrompt(message) {
            return new Promise((resolve) => {
                try {
                    // Sanitize the message
                    const sanitizedMessage = String(message || 'Enter value:')
                        .replace(/<[^>]*>/g, '')
                        .slice(0, 200);
                    
                    const input = prompt(sanitizedMessage);
                    
                    if (input === null) {
                        resolve(null);
                        return;
                    }
                    
                    // Sanitize and limit input
                    const sanitizedInput = String(input)
                        .slice(0, 1000)
                        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                    
                    resolve(sanitizedInput);
                } catch (error) {
                    console.error('Input error:', error);
                    resolve(null);
                }
            });
        }

        // Force editor resize
        function forceEditorResize() {
            if (editor) {
                const editorSection = document.querySelector('.editor-section');
                const height = editorSection.offsetHeight;
                editor.setSize("100%", Math.max(400, height - 10) + "px");
                editor.refresh();
            }
        }

        // File Management
        function openFile(filename) {
            try {
                // Save current file
                if (editor) {
                    fileContents[currentFile] = editor.getValue();
                }
                
                // Update UI
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('active');
                    item.removeAttribute('aria-current');
                    if (item.getAttribute('data-file') === filename.replace('.amitabhc', '')) {
                        item.classList.add('active');
                        item.setAttribute('aria-current', 'page');
                    }
                });
                
                // Load new file
                currentFile = filename;
                if (editor) {
                    const content = fileContents[filename] || '// New file\nLIGHTS\nCAMERA\n    BOLO "Hello AmitabhC!"\nACTION';
                    editor.setValue(content);
                    document.getElementById('tabName').textContent = filename;
                }
                
                updateStatus('File opened: ' + filename);
                announceToScreenReader(`Opened file: ${filename}`);
                
            } catch (error) {
                console.error('Open file error:', error);
                addOutput('‚ùå Failed to open file', 'error');
            }
        }

        function closeTab() {
            // In a real implementation, handle multiple tabs
            updateStatus('Tab management - Pro feature');
            announceToScreenReader('Tab close feature coming soon');
        }

        // Enhanced run code function
        async function runCode() {
            try {
                if (!editor || !interpreter) {
                    throw new Error('Editor or interpreter not available');
                }
                
                const code = editor.getValue().trim();
                const runButton = document.getElementById('runButton');
                
                if (!code) {
                    addOutput('üìù Please write some AmitabhC code first!', 'warning');
                    editor.focus();
                    return;
                }
                
                // Disable run button and show loading
                runButton.disabled = true;
                runButton.innerHTML = '‚è≥ Running...';
                document.getElementById('loadingSpinner').style.display = 'inline-block';
                document.getElementById('statusText').textContent = 'Running...';
                
                clearOutput();
                addOutput('üé¨ Lights... Camera... Action!', 'info');
                addOutput('üöÄ Starting AmitabhC Pro execution...', 'info');
                
                // Run with interpreter
                const result = await interpreter.run(code);
                
                if (result.success) {
                    addOutput('‚úÖ Program executed successfully!', 'success');
                    addOutput(`‚è±Ô∏è Execution time: ${result.executionTime}ms`, 'info');
                    addOutput(`üìä Memory usage: ${result.memoryUsage.variables} variables, ${result.memoryUsage.arrays} arrays, ${result.memoryUsage.functions} functions`, 'info');
                    addOutput('üé¨ "Keh diya, bas keh diya!" - Program completed!', 'success');
                    updateStatus('Ready');
                } else {
                    addOutput(`‚ùå Runtime Error: ${result.error}`, 'error');
                    addOutput('üîß Check your AmitabhC syntax and try again!', 'warning');
                    updateStatus('Error', 'error');
                }
                
                announceToScreenReader(result.success ? 'Program executed successfully' : 'Program execution failed');
                
            } catch (error) {
                console.error('Execution error:', error);
                addOutput(`‚ùå Execution failed: ${error.message}`, 'error');
                addOutput('üõ°Ô∏è Program stopped for security reasons', 'warning');
                updateStatus('Error', 'error');
            } finally {
                // Re-enable run button
                const runButton = document.getElementById('runButton');
                if (runButton) {
                    runButton.disabled = false;
                    runButton.innerHTML = '‚ñ∂Ô∏è Run';
                }
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('statusText').textContent = 'Ready';
            }
        }

        // Enhanced output function
        function addOutput(text, type = 'print') {
            try {
                const outputBody = document.getElementById('outputBody');
                if (!outputBody) return;
                
                // Sanitize text
                const sanitizedText = String(text || '')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .slice(0, 10000);
                
                const line = document.createElement('div');
                line.className = `output-line ${type}`;
                
                // Add icons and styling based on type
                let icon = '';
                switch (type) {
                    case 'print': icon = 'üí¨'; break;
                    case 'info': icon = '‚ÑπÔ∏è'; break;
                    case 'success': icon = '‚úÖ'; break;
                    case 'error': icon = '‚ùå'; break;
                    case 'warning': icon = '‚ö†Ô∏è'; break;
                    case 'kbc': icon = 'üéØ'; break;
                    default: icon = 'üìù';
                }
                
                line.innerHTML = `<span style="margin-right: 8px;" aria-hidden="true">${icon}</span>${sanitizedText}`;
                outputBody.appendChild(line);
                outputBody.scrollTop = outputBody.scrollHeight;
                
            } catch (error) {
                console.error('Output error:', error);
            }
        }

        function clearOutput() {
            try {
                const outputBody = document.getElementById('outputBody');
                if (outputBody) {
                    outputBody.innerHTML = '';
                    addOutput('Console cleared - Ready for new output! üßπ', 'info');
                }
            } catch (error) {
                console.error('Clear output error:', error);
            }
        }

        // UI Controls
        function toggleFullscreen() {
            const workspace = document.querySelector('.workspace');
            const currentGrid = workspace.style.gridTemplateRows;
            
            if (currentGrid.includes('0px')) {
                // Restore normal view
                workspace.style.gridTemplateRows = '48px minmax(300px, 1fr) minmax(200px, 400px)';
                announceToScreenReader('Restored normal view');
            } else {
                // Maximize output
                workspace.style.gridTemplateRows = '48px 0px 1fr';
                announceToScreenReader('Maximized output panel');
            }
            
            if (editor) {
                setTimeout(() => editor.refresh(), 100);
            }
        }

        function updateStatus(message, type = 'ready') {
            try {
                const statusElement = document.getElementById('mainStatus');
                const statusItem = statusElement.parentElement;
                
                statusElement.textContent = message;
                statusItem.className = `status-item ${type}`;
                updateStatus.lastStatus = message;
            } catch (error) {
                console.error('Status update error:', error);
            }
        }

        // AI Assistant functions and other helper functions would continue here...
        // (I'll continue with the remaining functions in the next part due to length)

        // Rest of the JavaScript code remains the same as in the original file
        // Including AI functions, file management, resize handlers, etc.
        
        function toggleAI() {
            try {
                const aiChat = document.getElementById('aiChat');
                const aiToggle = document.getElementById('aiToggle');
                const isOpen = aiChat.classList.contains('active');
                
                if (isOpen) {
                    aiChat.classList.remove('active');
                    aiToggle.setAttribute('aria-expanded', 'false');
                    announceToScreenReader('AI Assistant closed');
                } else {
                    aiChat.classList.add('active');
                    aiToggle.setAttribute('aria-expanded', 'true');
                    document.getElementById('aiInput').focus();
                    announceToScreenReader('AI Assistant opened');
                }
            } catch (error) {
                console.error('Toggle AI error:', error);
            }
        }

        function sendAIMessage() {
            try {
                const input = document.getElementById('aiInput');
                const messages = document.getElementById('aiMessages');
                const userMessage = input.value.trim();
                
                if (!userMessage) return;
                
                // Sanitize input
                const sanitizedMessage = userMessage
                    .replace(/<[^>]*>/g, '')
                    .slice(0, 1000);
                
                // Add user message
                const userDiv = document.createElement('div');
                userDiv.className = 'ai-message user';
                userDiv.textContent = sanitizedMessage;
                messages.appendChild(userDiv);
                
                // Clear input
                input.value = '';
                
                // Generate AI response
                setTimeout(() => {
                    const aiDiv = document.createElement('div');
                    aiDiv.className = 'ai-message ai';
                    aiDiv.innerHTML = generateAIResponse(sanitizedMessage);
                    messages.appendChild(aiDiv);
                    messages.scrollTop = messages.scrollHeight;
                }, 1000);
                
                messages.scrollTop = messages.scrollHeight;
                
            } catch (error) {
                console.error('Send AI message error:', error);
            }
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('error') || lowerMessage.includes('bug') || lowerMessage.includes('not working')) {
                return `üêõ <strong>Debugging AmitabhC Code:</strong><br><br>
                <strong>Common Issues & Solutions:</strong><br>
                ‚Ä¢ Program structure: Start with <code>LIGHTS</code>, include <code>CAMERA</code>, end with <code>ACTION</code><br>
                ‚Ä¢ Block endings: <code>AGAR...BAS</code>, <code>BAAR BAAR...KHATAM</code>, <code>JAB TAK...RAHEGA</code><br>
                ‚Ä¢ Function syntax: <code>NAAM functionName()...PURA</code><br>
                ‚Ä¢ Variable naming: Use <code>VIJAY varName = value</code><br><br>
                <strong>Pro Tip:</strong> Use the browser console (F12) for detailed error information!`;
            }
            
            return `ü§ñ <strong>AmitabhC Pro AI Assistant</strong><br><br>
            Welcome! I can help with syntax, debugging, KBC features, and more!<br><br>
            Ask me about:<br>
            ‚Ä¢ Code syntax and structure<br>
            ‚Ä¢ Function creation and usage<br>
            ‚Ä¢ KBC interactive programming<br>
            ‚Ä¢ Debugging and optimization<br><br>
            üé¨ <strong>Ready to code like a Bollywood superstar?</strong>`;
        }

        function initializeAI() {
            try {
                const messages = document.getElementById('aiMessages');
                const welcomeMsg = document.createElement('div');
                welcomeMsg.className = 'ai-message ai';
                welcomeMsg.innerHTML = `üé¨ <strong>Welcome to AmitabhC Pro!</strong><br><br>
                I'm your AI coding assistant, ready to help with:<br>
                ‚Ä¢ Secure AmitabhC programming<br>
                ‚Ä¢ Advanced debugging<br>
                ‚Ä¢ KBC-style development<br>
                ‚Ä¢ Performance optimization<br><br>
                Ask me anything! ‚ú®`;
                messages.appendChild(welcomeMsg);
            } catch (error) {
                console.error('AI initialization error:', error);
            }
        }

        // Additional helper functions
        function exportCode() {
            try {
                if (!editor) return;
                
                const code = editor.getValue();
                const filename = currentFile || 'amitabhc_program.amitabhc';
                
                if (!code.trim()) {
                    addOutput('üìù No code to export!', 'warning');
                    return;
                }
                
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:.]/g, '-');
                const safeFilename = `${filename.replace('.amitabhc', '')}-${timestamp}.amitabhc`;
                
                const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = safeFilename;
                a.style.display = 'none';
                
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                addOutput(`üì• Code exported as ${safeFilename}`, 'success');
                updateStatus('Code exported successfully');
                
            } catch (error) {
                console.error('Export error:', error);
                addOutput('‚ùå Export failed', 'error');
            }
        }

        function saveToCloud() {
            try {
                if (!editor) return;
                
                const code = editor.getValue();
                const timestamp = new Date().toISOString();
                
                localStorage.setItem('amitabhc_pro_autosave', code);
                localStorage.setItem('amitabhc_pro_autosave_time', timestamp);
                localStorage.setItem('amitabhc_pro_current_file', currentFile);
                
                addOutput('‚òÅÔ∏è Code saved to local storage', 'success');
                updateStatus('Auto-saved');
                
            } catch (error) {
                console.error('Save error:', error);
                addOutput('‚ùå Save failed', 'error');
            }
        }

        function announceToScreenReader(message) {
            try {
                const announcement = document.createElement('div');
                announcement.setAttribute('aria-live', 'polite');
                announcement.setAttribute('aria-atomic', 'true');
                announcement.className = 'sr-only';
                announcement.textContent = message;
                document.body.appendChild(announcement);
                
                setTimeout(() => {
                    if (document.body.contains(announcement)) {
                        document.body.removeChild(announcement);
                    }
                }, 1000);
            } catch (error) {
                console.error('Announcement error:', error);
            }
        }

        function toggleMobileSidebar() {
            try {
                const sidebar = document.querySelector('.sidebar');
                const toggle = document.querySelector('.mobile-toggle');
                const isOpen = sidebar.classList.contains('mobile-open');
                
                if (isOpen) {
                    sidebar.classList.remove('mobile-open');
                    toggle.setAttribute('aria-expanded', 'false');
                } else {
                    sidebar.classList.add('mobile-open');
                    toggle.setAttribute('aria-expanded', 'true');
                }
            } catch (error) {
                console.error('Mobile sidebar toggle error:', error);
            }
        }

        function setupResize() {
            // Resize functionality implementation
            const resizeHandle = document.getElementById('resizeHandle');
            // ... resize implementation code
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            try {
                if (e.key === 'F5') {
                    e.preventDefault();
                    runCode();
                }
                
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveToCloud();
                }
                
                if (e.key === 'Escape') {
                    const aiChat = document.getElementById('aiChat');
                    if (aiChat.classList.contains('active')) {
                        toggleAI();
                    }
                }
            } catch (error) {
                console.error('Keyboard shortcut error:', error);
            }
        });

        console.log('AmitabhC Pro IDE ready! üé¨');
    </script>
</body>
</html>